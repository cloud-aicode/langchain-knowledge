<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬åˆ†å‰²å™¨ API - LangChain 1.0</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="chapter-api-text-splitters">
    <button class="theme-toggle">ğŸŒ“</button>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>

    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1><a href="../index.html" style="color: white; text-decoration: none;">LangChain 1.0</a></h1>
                <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 5px;">API å‚è€ƒ</p>
            </div>
            <div class="sidebar-nav"></div>
        </nav>

        <main class="main-content">
            <div class="content">
                <h1>æ–‡æœ¬åˆ†å‰²å™¨ API</h1>
                <p class="subtitle">TextSplitter ä¸æ–‡æœ¬åˆ†å‰²</p>

                <div class="api-nav">
                    <a href="#overview" class="api-nav-link">æ¦‚è¿°</a>
                    <a href="#base" class="api-nav-link">åŸºç±»</a>
                    <a href="#splitters" class="api-nav-link">å¸¸ç”¨åˆ†å‰²å™¨</a>
                    <a href="#examples" class="api-nav-link">ç¤ºä¾‹</a>
                </div>

                <h2 id="overview">æ¦‚è¿°</h2>
                <p>æ–‡æœ¬åˆ†å‰²å™¨å°†é•¿æ–‡æœ¬åˆ†å‰²ä¸ºè¾ƒå°çš„å—ï¼Œä»¥ä¾¿äºåµŒå…¥å’Œæ£€ç´¢ã€‚LangChain æä¾›äº†å¤šç§åˆ†å‰²ç­–ç•¥ã€‚</p>

                <pre class="mermaid">graph TD
                    A[TextSplitter] --> B[CharacterTextSplitter]
                    A --> C[RecursiveCharacterTextSplitter]
                    A --> D[SemanticTextSplitter]

                    A --> E[ä»£ç åˆ†å‰²]
                    E --> F[PythonCodeSplitter]
                    E --> G[JavaScriptSplitter]

                    A --> H[ç‰¹æ®Šæ ¼å¼]
                    H --> I[MarkdownTextSplitter]
                    H --> J[LatexTextSplitter]

                    style A fill:#e1f5fe
                    style C fill:#c8e6c9</code></pre>

                <h2 id="base">åŸºç±»</h2>

                <div class="api-section">
                    <h3 class="api-title">TextSplitter</h3>
                    <p class="api-description">æ‰€æœ‰æ–‡æœ¬åˆ†å‰²å™¨çš„æŠ½è±¡åŸºç±»ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_text_splitters import TextSplitter

class TextSplitter(ABC):
    """æ–‡æœ¬åˆ†å‰²å™¨åŸºç±»"""

    def split_text(self, text: str) -> List[str]:
        """
        åˆ†å‰²æ–‡æœ¬

        Args:
            text: è¦åˆ†å‰²çš„æ–‡æœ¬

        Returns:
            åˆ†å‰²åçš„æ–‡æœ¬å—åˆ—è¡¨
        """

    def split_documents(self, documents: List[Document]) -> List[Document]:
        """
        åˆ†å‰²æ–‡æ¡£åˆ—è¡¨

        Args:
            documents: Document åˆ—è¡¨

        Returns:
            åˆ†å‰²åçš„ Document åˆ—è¡¨
        """

    @staticmethod
    def _join_docs(docs: List[str], separator: str) -> str:
        """åˆå¹¶æ–‡æ¡£å—"""

    def create_documents(
        self,
        texts: List[str],
        metadatas: Optional[List[dict]] = None,
    ) -> List[Document]:
        """ä»æ–‡æœ¬åˆ›å»ºæ–‡æ¡£"""

    def split_text_to_chunks(self, text: str) -> Iterator[str]:
        """ç”Ÿæˆæ–‡æœ¬å—ï¼ˆè¿­ä»£å™¨ï¼‰"""</code></pre>
                    </div>
                </div>

                <h2 id="splitters">å¸¸ç”¨åˆ†å‰²å™¨</h2>

                <div class="api-section">
                    <h3 class="api-title">RecursiveCharacterTextSplitter</h3>
                    <p class="api-description">é€’å½’å­—ç¬¦åˆ†å‰²å™¨ï¼ˆæ¨èï¼‰ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_text_splitters import RecursiveCharacterTextSplitter

class RecursiveCharacterTextSplitter(TextSplitter):
    """é€’å½’å­—ç¬¦åˆ†å‰²å™¨"""

    def __init__(
        self,
        separators: Optional[List[str]] = None,
        keep_separator: bool = True,
        chunk_size: int = 4000,
        chunk_overlap: int = 200,
        length_function: Callable[[str], int] = len,
        strip_whitespace: bool = True,
    ):
        """
        åˆå§‹åŒ–

        Args:
            separators: åˆ†éš”ç¬¦åˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
                é»˜è®¤: ["\n\n", "\n", " ", ""]
            keep_separator: æ˜¯å¦åœ¨ç»“æœä¸­ä¿ç•™åˆ†éš”ç¬¦
            chunk_size: å—å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
            chunk_overlap: å—ä¹‹é—´çš„é‡å å­—ç¬¦æ•°
            length_function: è®¡ç®—é•¿åº¦çš„å‡½æ•°
            strip_whitespace: æ˜¯å¦å»é™¤ç©ºç™½
        """

    def split_text(self, text: str) -> List[str]:
        """
        é€’å½’åˆ†å‰²æ–‡æœ¬

        ä¼˜å…ˆä½¿ç”¨å‰ä¸€ä¸ªåˆ†éš”ç¬¦åˆ†å‰²ï¼Œ
        å¦‚æœå—ä»å¤ªå¤§ï¼Œåˆ™ä½¿ç”¨ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_text_splitters import RecursiveCharacterTextSplitter

# åŸºç¡€ä½¿ç”¨
splitter = RecursiveCharacterTextSplitter(
    chunk_size=1000,
    chunk_overlap=200
)

chunks = splitter.split_text(large_text)

# è‡ªå®šä¹‰åˆ†éš”ç¬¦
splitter = RecursiveCharacterTextSplitter(
    separators=["\n\n\n", "\n\n", "\n", "ã€‚", "ï¼", "ï¼Ÿ", " ", ""],
    chunk_size=500,
    chunk_overlap=50
)

# åˆ†å‰²æ–‡æ¡£
from langchain_core.documents import Document

documents = splitter.split_documents([
    Document(page_content=large_text)
])

# ä½¿ç”¨ token è®¡æ•°
import tiktoken

encoding = tiktoken.get_encoding("cl100k_base")

def token_count(text: str) -> int:
    return len(encoding.encode(text))

splitter = RecursiveCharacterTextSplitter(
    chunk_size=1000,  # 1000 tokens
    chunk_overlap=200,
    length_function=token_count
)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">CharacterTextSplitter</h3>
                    <p class="api-description">ç®€å•å­—ç¬¦åˆ†å‰²å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_text_splitters import CharacterTextSplitter

class CharacterTextSplitter(TextSplitter):
    """å­—ç¬¦åˆ†å‰²å™¨"""

    def __init__(
        self,
        separator: str = "\n\n",
        keep_separator: bool = False,
        chunk_size: int = 4000,
        chunk_overlap: int = 200,
        length_function: Callable[[str], int] = len,
        strip_whitespace: bool = True,
    ):
        """
        åˆå§‹åŒ–

        Args:
            separator: åˆ†éš”ç¬¦ï¼ˆä»…ä½¿ç”¨ä¸€ä¸ªï¼‰
            keep_separator: æ˜¯å¦ä¿ç•™åˆ†éš”ç¬¦
            chunk_size: å—å¤§å°
            chunk_overlap: é‡å å¤§å°
            length_function: é•¿åº¦è®¡ç®—å‡½æ•°
            strip_whitespace: æ˜¯å¦å»é™¤ç©ºç™½
        """

    def split_text(self, text: str) -> List[str]:
        """
        æŒ‰åˆ†éš”ç¬¦åˆ†å‰²æ–‡æœ¬
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_text_splitters import CharacterTextSplitter

# æŒ‰æ®µè½åˆ†å‰²
splitter = CharacterTextSplitter(
    separator="\n\n",
    chunk_size=1000,
    chunk_overlap=100
)

chunks = splitter.split_text(text)

# æŒ‰å¥å­åˆ†å‰²
splitter = CharacterTextSplitter(
    separator="ã€‚",
    chunk_size=500,
    chunk_overlap=50,
    keep_separator=True
)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">SemanticTextSplitter</h3>
                    <p class="api-description">è¯­ä¹‰åˆ†å‰²å™¨ï¼ˆåŸºäºåµŒå…¥ç›¸ä¼¼åº¦ï¼‰ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_experimental.text_splitter import SemanticTextSplitter

class SemanticTextSplitter(TextSplitter):
    """è¯­ä¹‰åˆ†å‰²å™¨"""

    def __init__(
        self,
        embeddings: Embeddings,
        breakpoint_threshold: float = 0.5,
        buffer_size: int = 1,
        chunk_size: int = 1000,
    ):
        """
        åˆå§‹åŒ–

        Args:
            embeddings: åµŒå…¥æ¨¡å‹
            breakpoint_threshold: åˆ†å‰²é˜ˆå€¼ï¼ˆ0-1ï¼‰
            buffer_size: ç¼“å†²åŒºå¤§å°
            chunk_size: ç›®æ ‡å—å¤§å°
        """

    def split_text(self, text: str) -> List[str]:
        """
        åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦åˆ†å‰²
        åœ¨è¯­ä¹‰å˜åŒ–å¤§çš„ä½ç½®åˆ†å‰²
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_experimental.text_splitter import SemanticTextSplitter
from langchain_openai import OpenAIEmbeddings

splitter = SemanticTextSplitter(
    embeddings=OpenAIEmbeddings(),
    breakpoint_threshold=0.6,
    chunk_size=1000
)

chunks = splitter.split_text(long_article)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">ä»£ç åˆ†å‰²å™¨</h3>

                    <h4>PythonCodeSplitter</h4>
                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_text_splitters import PythonCodeSplitter

splitter = PythonCodeSplitter(
    chunk_size=1000,
    chunk_overlap=100
)

# æŒ‰å‡½æ•°ã€ç±»å®šä¹‰åˆ†å‰²
chunks = splitter.split_text(python_code)</code></pre>
                    </div>

                    <h4>JavaScriptSplitter</h4>
                    <div class="code-signature">
                        <pre><code class="language-python">from langchain_text_splitters import JavaScriptSplitter

splitter = JavaScriptSplitter(
    chunk_size=1000,
    chunk_overlap=100
)

chunks = splitter.split_text(js_code)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">MarkdownTextSplitter</h3>
                    <p class="api-description">Markdown æ–‡æœ¬åˆ†å‰²å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_text_splitters import MarkdownTextSplitter

class MarkdownTextSplitter(TextSplitter):
    """Markdown åˆ†å‰²å™¨"""

    def __init__(
        self,
        headers_to_split_on: List[Tuple[str, str]] = [
            ("#", "Header 1"),
            ("##", "Header 2"),
            ("###", "Header 3"),
        ],
        chunk_size: int = 4000,
        chunk_overlap: int = 200,
    ):
        """
        åˆå§‹åŒ–

        Args:
            headers_to_split_on: è¦åˆ†å‰²çš„æ ‡é¢˜çº§åˆ«
            chunk_size: å—å¤§å°
            chunk_overlap: é‡å å¤§å°
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_text_splitters import MarkdownTextSplitter

splitter = MarkdownTextSplitter(
    headers_to_split_on=[
        ("#", "Header 1"),
        ("##", "Header 2"),
        ("###", "Header 3"),
    ],
    chunk_size=2000,
    chunk_overlap=200
)

chunks = splitter.split_text(markdown_content)

# å¸¦å…ƒæ•°æ®çš„åˆ†å‰²
from langchain_text_splitters import MarkdownHeaderTextSplitter

splitter = MarkdownHeaderTextSplitter(
    headers_to_split_on=[
        ("#", "Header 1"),
        ("##", "Header 2"),
    ]
)

docs = splitter.split_text(markdown_content)
# æ¯ä¸ª Document åŒ…å«å¯¹åº”çº§åˆ«çš„æ ‡é¢˜ä½œä¸º metadata</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">LatexTextSplitter</h3>
                    <p class="api-description">LaTeX æ–‡æœ¬åˆ†å‰²å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_text_splitters import LatexTextSplitter

splitter = LatexTextSplitter(
    chunk_size=1000,
    chunk_overlap=100
)

chunks = splitter.split_text(latex_content)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">NLTKTextSplitter</h3>
                    <p class="api-description">ä½¿ç”¨ NLTK è¿›è¡Œå¥å­åˆ†å‰²ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_text_splitters import NLTKTextSplitter

splitter = NLTKTextSplitter(
    chunk_size=1000,
    chunk_overlap=100
)

chunks = splitter.split_text(text)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">SpacyTextSplitter</h3>
                    <p class="api-description">ä½¿ç”¨ spaCy è¿›è¡Œå¥å­åˆ†å‰²ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_text_splitters import SpacyTextSplitter

splitter = SpacyTextSplitter(
    chunk_size=1000,
    chunk_overlap=100,
    separator=" "  # ä½¿ç”¨ spaCy çš„å¥å­è¾¹ç•Œ
)

chunks = splitter.split_text(text)</code></pre>
                    </div>
                </div>

                <h2 id="examples">ä½¿ç”¨ç¤ºä¾‹</h2>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python"># ========== ç¤ºä¾‹1: é€’å½’åˆ†å‰² ==========
from langchain_text_splitters import RecursiveCharacterTextSplitter

splitter = RecursiveCharacterTextSplitter(
    chunk_size=1000,
    chunk_overlap=200,
    length_function=len,
)

chunks = splitter.split_text(large_text)
print(f"åˆ†å‰²æˆ {len(chunks)} å—")

# ========== ç¤ºä¾‹2: åˆ†å‰²æ–‡æ¡£åˆ—è¡¨ ==========
from langchain_core.documents import Document

documents = [
    Document(page_content="æ–‡æ¡£1å†…å®¹..."),
    Document(page_content="æ–‡æ¡£2å†…å®¹...")
]

split_docs = splitter.split_documents(documents)

# ========== ç¤ºä¾‹3: è‡ªå®šä¹‰åˆ†éš”ç¬¦ ==========
splitter = RecursiveCharacterTextSplitter(
    separators=["\n\n\n", "\n\n", "\n", "ã€‚", "ï¼", "ï¼Ÿ", " ", ""],
    chunk_size=500,
    chunk_overlap=50,
    keep_separator=True
)

# ========== ç¤ºä¾‹4: ä½¿ç”¨ token è®¡æ•° ==========
import tiktoken

encoding = tiktoken.encoding_for_model("gpt-4")

def token_count(text: str) -> int:
    return len(encoding.encode(text))

splitter = RecursiveCharacterTextSplitter(
    chunk_size=1000,  # tokens
    chunk_overlap=200,
    length_function=token_count
)

# ========== ç¤ºä¾‹5: æ·»åŠ å…ƒæ•°æ® ==========
from langchain_core.documents import Document
from typing import Dict, List

class MetadataSplitter(RecursiveCharacterTextSplitter):
    def split_text(self, text: str, metadata: Dict = None) -> List[Document]:
        chunks = super().split_text(text)
        return [
            Document(
                page_content=chunk,
                metadata=metadata or {}
            )
            for chunk in chunks
        ]

splitter = MetadataSplitter(chunk_size=1000, chunk_overlap=200)
docs = splitter.split_text(text, metadata={"source": "document.txt"})

# ========== ç¤ºä¾‹6: HTML å†…å®¹åˆ†å‰² ==========
from langchain_text_splitters import HTMLHeaderTextSplitter

html_splitter = HTMLHeaderTextSplitter(
    headers_to_split_on=[
        ("h1", "Header 1"),
        ("h2", "Header 2"),
        ("h3", "Header 3"),
    ]
)

docs = html_splitter.split_text(html_content)

# ========== ç¤ºä¾‹7: é€’å½’åˆ†å‰² HTML ==========
from langchain_text_splitters import RecursiveCharacterTextSplitter

html_splitter = HTMLHeaderTextSplitter()
text_splitter = RecursiveCharacterTextSplitter(chunk_size=1000)

# å…ˆæŒ‰ HTML ç»“æ„åˆ†å‰²ï¼Œå†æŒ‰å­—ç¬¦åˆ†å‰²
html_docs = html_splitter.split_text(html_content)
final_docs = text_splitter.split_documents(html_docs)

# ========== ç¤ºä¾‹8: æµå¼åˆ†å‰²å¤§æ–‡ä»¶ ==========

def split_large_file(file_path: str, chunk_size: int = 1000):
    """æµå¼åˆ†å‰²å¤§æ–‡ä»¶"""
    splitter = RecursiveCharacterTextSplitter(
        chunk_size=chunk_size,
        chunk_overlap=200
    )

    with open(file_path, 'r') as f:
        content = f.read()

    for i, chunk in enumerate(splitter.split_text(content)):
        yield {
            "index": i,
            "content": chunk,
            "metadata": {"source": file_path, "chunk": i}
        }

# ä½¿ç”¨
for chunk_data in split_large_file("large.txt"):
    process_chunk(chunk_data)</code></pre>
                </div>

                <h2>å‚æ•°å»ºè®®</h2>

                <div class="comparison-table">
                    <tr>
                        <th>åœºæ™¯</th>
                        <th>chunk_size</th>
                        <th>chunk_overlap</th>
                        <th>åˆ†éš”ç¬¦</th>
                    </tr>
                    <tr>
                        <td>é€šç”¨æ–‡æœ¬</td>
                        <td>1000-2000</td>
                        <td>200</td>
                        <td>é»˜è®¤</td>
                    </tr>
                    <tr>
                        <td>ä»£ç </td>
                        <td>500-1000</td>
                        <td>50-100</td>
                        <td>ä»£ç ç›¸å…³</td>
                    </tr>
                    <tr>
                        <td>é•¿æ–‡æ¡£</td>
                        <td>2000-4000</td>
                        <td>400</td>
                        <td>æ®µè½ã€å¥å­</td>
                    </tr>
                    <tr>
                        <td>ä¸­æ–‡æ–‡æœ¬</td>
                        <td>500-1000</td>
                        <td>100</td>
                        <td>å¥å­ã€æ ‡ç‚¹</td>
                    </tr>
                </table>

                <h2>ç›¸å…³ API</h2>
                <ul>
                    <li><a href="document-loaders.html">Document Loaders API</a></li>
                    <li><a href="embeddings.html">Embeddings API</a></li>
                    <li><a href="../08-text-splitters.html">æ•™ç¨‹ï¼šæ–‡æœ¬åˆ†å‰²</a></li>
                </ul>

                <div class="chapter-nav">
                    <a href="document-loaders.html">â† Document Loaders API</a>
                    <a href="embeddings.html" class="next">Embeddings API â†’</a>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="../assets/js/main.js"></script>
</body>
</html>
