<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç¤ºæ¨¡æ¿ API - LangChain 1.0</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="chapter-api-prompts">
    <button class="theme-toggle">ğŸŒ“</button>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>

    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>LangChain 1.0</h1>
                <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 5px;">API å‚è€ƒ</p>
            </div>
            <div class="sidebar-nav"></div>
        </nav>

        <main class="main-content">
            <div class="content">
                <h1>æç¤ºæ¨¡æ¿ API</h1>
                <p class="subtitle">PromptTemplate ä¸æ¶ˆæ¯æ¨¡æ¿</p>

                <div class="api-nav">
                    <a href="#overview" class="api-nav-link">æ¦‚è¿°</a>
                    <a href="#classes" class="api-nav-link">æ ¸å¿ƒç±»</a>
                    <a href="#methods" class="api-nav-link">æ–¹æ³•</a>
                    <a href="#examples" class="api-nav-link">ç¤ºä¾‹</a>
                </div>

                <h2 id="overview">æ¦‚è¿°</h2>
                <p>æç¤ºæ¨¡æ¿æ˜¯ LangChain ä¸­ç®¡ç† LLM è¾“å…¥çš„æ ¸å¿ƒç»„ä»¶ï¼Œæä¾›å‚æ•°åŒ–ã€éªŒè¯å’Œæ ¼å¼åŒ–åŠŸèƒ½ã€‚</p>

                <pre class="mermaid">graph TD
                    A[BasePromptTemplate] --> B[PromptTemplate]
                    A --> C[ChatPromptTemplate]
                    A --> D[MessagesPlaceholder]

                    C --> E[SystemMessagePromptTemplate]
                    C --> F[HumanMessagePromptTemplate]
                    C --> G[AIMessagePromptTemplate]

                    A --> H[FewShotPromptTemplate]
                    A --> I[PipelinePromptTemplate]

                    style A fill:#e1f5fe
                    style C fill:#c8e6c9</code></pre>

                <h2 id="classes">æ ¸å¿ƒç±»</h2>

                <div class="api-section" id="baseprompttemplate">
                    <h3 class="api-title">BasePromptTemplate</h3>
                    <p class="api-description">æ‰€æœ‰æç¤ºæ¨¡æ¿çš„æŠ½è±¡åŸºç±»ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">class BasePromptTemplate(Serializable, Generic[InputVariables, OutputType]):
    """æç¤ºæ¨¡æ¿åŸºç±»"""

    @property
    @abstractmethod
    def input_variables(self) -> List[str]:
        """è¾“å…¥å˜é‡ååˆ—è¡¨"""

    @abstractmethod
    def format(**kwargs: Any) -> OutputType:
        """æ ¼å¼åŒ–æ¨¡æ¿"""

    @abstractmethod
    def partial(**kwargs: Any) -> "BasePromptTemplate":
        """éƒ¨åˆ†å¡«å……æ¨¡æ¿"""

    def invoke(
        self,
        input: Dict[str, Any],
        config: Optional[RunnableConfig] = None,
    ) -> OutputType:
        """è°ƒç”¨æ¨¡æ¿ï¼ˆRunnable æ¥å£ï¼‰"""</code></pre>
                    </div>
                </div>

                <div class="api-section" id="prompttemplate">
                    <h3 class="api-title">PromptTemplate</h3>
                    <p class="api-description">å­—ç¬¦ä¸²æç¤ºæ¨¡æ¿ï¼Œç”¨äºç”Ÿæˆçº¯æ–‡æœ¬æç¤ºã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">class PromptTemplate(BasePromptTemplate[Dict[str, Any], str]):
    """å­—ç¬¦ä¸²æç¤ºæ¨¡æ¿"""

    template: str = ""
    """æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ {variable} è¯­æ³•"""

    input_variables: List[str] = []
    """è¾“å…¥å˜é‡ååˆ—è¡¨"""

    template_format: str = "f-string"
    """æ¨¡æ¿æ ¼å¼: f-string, jinja2"""

    validate_template: bool = False
    """æ˜¯å¦éªŒè¯æ¨¡æ¿"""

    partial_variables: Dict[str, Any] = {}
    """éƒ¨åˆ†å¡«å……çš„å˜é‡"""</code></pre>
                    </div>

                    <h4>æ„é€ æ–¹æ³•</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_core.prompts import PromptTemplate

# æ–¹å¼1: ä½¿ç”¨ from_template
prompt = PromptTemplate.from_template(
    "Tell me a joke about {topic}"
)

# æ–¹å¼2: ç›´æ¥å®ä¾‹åŒ–
prompt = PromptTemplate(
    template="Tell me a joke about {topic}",
    input_variables=["topic"]
)

# æ–¹å¼3: ä½¿ç”¨ template_format
jinja_prompt = PromptTemplate(
    template="Tell me a joke about {{ topic }}",
    input_variables=["topic"],
    template_format="jinja2"
)</code></pre>
                    </div>
                </div>

                <div class="api-section" id="chatprompttemplate">
                    <h3 class="api-title">ChatPromptTemplate</h3>
                    <p class="api-description">èŠå¤©æ¶ˆæ¯æç¤ºæ¨¡æ¿ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">class ChatPromptTemplate(BasePromptTemplate[Dict[str, Any], List[BaseMessage]]):
    """èŠå¤©æç¤ºæ¨¡æ¿"""

    messages: List[Union[MessagePromptTemplate, MsgPlaceholder]]
    """æ¶ˆæ¯æ¨¡æ¿åˆ—è¡¨"""

    input_variables: List[str] = []
    """è¾“å…¥å˜é‡"""</code></pre>
                    </div>

                    <h4>åˆ›å»ºæ–¹å¼</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_core.prompts import ChatPromptTemplate

# æ–¹å¼1: ä½¿ç”¨ from_messages
prompt = ChatPromptTemplate.from_messages([
    ("system", "You are a helpful assistant"),
    ("user", "{input}")
])

# æ–¹å¼2: ä½¿ç”¨æ¶ˆæ¯ç±»
from langchain_core.prompts import (
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate
)

system_prompt = SystemMessagePromptTemplate.from_template(
    "You are a {role} assistant"
)
user_prompt = HumanMessagePromptTemplate.from_template("{input}")
prompt = ChatPromptTemplate.from_messages([system_prompt, user_prompt])

# æ–¹å¼3: ä½¿ç”¨å­—ç¬¦ä¸²å…ƒç»„
prompt = ChatPromptTemplate.from_messages([
    ("system", "You are a helpful assistant"),
    MessagesPlaceholder(variable_name="history"),  # å¯¹è¯å†å²
    ("user", "{input}")
])</code></pre>
                    </div>
                </div>

                <div class="api-section" id="messagesplaceholder">
                    <h3 class="api-title">MessagesPlaceholder</h3>
                    <p class="api-description">æ¶ˆæ¯å ä½ç¬¦ï¼Œç”¨äºæ’å…¥åŠ¨æ€æ¶ˆæ¯åˆ—è¡¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">class MessagesPlaceholder(BasePromptTemplate):
    """æ¶ˆæ¯å ä½ç¬¦"""

    variable_name: str
    """å˜é‡å"""

    optional: bool = False
    """æ˜¯å¦å¯é€‰"""</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_core.prompts import (
    ChatPromptTemplate,
    MessagesPlaceholder
)

prompt = ChatPromptTemplate.from_messages([
    ("system", "You are a helpful assistant"),
    MessagesPlaceholder(variable_name="history"),  # æ’å…¥å¯¹è¯å†å²
    ("user", "{input}")
])

# ä½¿ç”¨
formatted = prompt.format_messages(
    history=[
        ("user", "ä½ å¥½"),
        ("ai", "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„ï¼Ÿ")
    ],
    input="ä»‹ç»ä¸€ä¸‹ LangChain"
)</code></pre>
                    </div>
                </div>

                <div class="api-section" id="fewshotprompttemplate">
                    <h3 class="api-title">FewShotPromptTemplate</h3>
                    <p class="api-description">å°‘æ ·æœ¬æç¤ºæ¨¡æ¿ï¼Œæä¾›ç¤ºä¾‹ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">class FewShotPromptTemplate(BasePromptTemplate[Dict[str, Any], str]):
    """å°‘æ ·æœ¬æç¤ºæ¨¡æ¿"""

    examples: List[Dict[str, Any]]
    """ç¤ºä¾‹åˆ—è¡¨"""

    example_prompt: PromptTemplate
    """å•ä¸ªç¤ºä¾‹çš„æ¨¡æ¿"""

    suffix: str
    """åç¼€æ¨¡æ¿"""

    prefix: str = ""
    """å‰ç¼€æ¨¡æ¿"""

    example_separator: str = "\n\n"
    """ç¤ºä¾‹åˆ†éš”ç¬¦"""

    input_variables: List[str]
    """è¾“å…¥å˜é‡"""</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_core.prompts import FewShotPromptTemplate, PromptTemplate

# å®šä¹‰ç¤ºä¾‹
examples = [
    {"question": "å·´é»", "answer": "æ³•å›½"},
    {"question": "ä¸œäº¬", "answer": "æ—¥æœ¬"},
    {"question": "ä¼¦æ•¦", "answer": "è‹±å›½"}
]

# ç¤ºä¾‹æ¨¡æ¿
example_prompt = PromptTemplate(
    input_variables=["question", "answer"],
    template="é—®é¢˜: {question}\nç­”æ¡ˆ: {answer}"
)

# åˆ›å»º FewShot æ¨¡æ¿
prompt = FewShotPromptTemplate(
    examples=examples,
    example_prompt=example_prompt,
    prefix="ä»¥ä¸‹æ˜¯é¦–éƒ½ä¸å…¶å¯¹åº”çš„å›½å®¶ï¼š",
    suffix="\né—®é¢˜: {input}\nç­”æ¡ˆ:",
    input_variables=["input"]
)

# ä½¿ç”¨
formatted = prompt.format(input="åŒ—äº¬")
print(formatted)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">PipelinePromptTemplate</h3>
                    <p class="api-description">ç®¡é“æç¤ºæ¨¡æ¿ï¼Œç»„åˆå¤šä¸ªæ¨¡æ¿ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">class PipelinePromptTemplate(BasePromptTemplate):
    """ç®¡é“æç¤ºæ¨¡æ¿"""

    pipeline_prompts: List[Tuple[str, BasePromptTemplate]]
    """(åç§°, æ¨¡æ¿) åˆ—è¡¨"""

    final_prompt: PromptTemplate
    """æœ€ç»ˆæ¨¡æ¿ï¼Œå¼•ç”¨æ‰€æœ‰å‘½åç»„ä»¶"""</code></pre>
                    </div>
                </div>

                <h2 id="methods">æ ¸å¿ƒæ–¹æ³•</h2>

                <div class="api-section">
                    <h3 class="api-title">format</h3>
                    <p class="api-description">æ ¼å¼åŒ–æ¨¡æ¿ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">def format(**kwargs: Any) -> Union[str, List[BaseMessage]]:
    """
    æ ¼å¼åŒ–æ¨¡æ¿

    Args:
        **kwargs: å˜é‡å€¼

    Returns:
        æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²æˆ–æ¶ˆæ¯åˆ—è¡¨
    """</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">format_messages</h3>
                    <p class="api-description">æ ¼å¼åŒ–ä¸ºæ¶ˆæ¯åˆ—è¡¨ï¼ˆä»… ChatPromptTemplateï¼‰ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">def format_messages(**kwargs: Any) -> List[BaseMessage]:
    """
    æ ¼å¼åŒ–ä¸ºæ¶ˆæ¯åˆ—è¡¨

    Args:
        **kwargs: å˜é‡å€¼

    Returns:
        æ¶ˆæ¯åˆ—è¡¨
    """</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">partial</h3>
                    <p class="api-description">éƒ¨åˆ†å¡«å……æ¨¡æ¿ï¼Œè¿”å›æ–°æ¨¡æ¿ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">def partial(**kwargs: Any) -> BasePromptTemplate:
    """
    éƒ¨åˆ†å¡«å……

    Args:
        **kwargs: è¦é¢„å…ˆå¡«å……çš„å˜é‡

    Returns:
        éƒ¨åˆ†å¡«å……çš„æ–°æ¨¡æ¿
    """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_core.prompts import PromptTemplate

prompt = PromptTemplate(
    template="Tell me a {adjective} joke about {topic}",
    input_variables=["adjective", "topic"]
)

# éƒ¨åˆ†å¡«å……
funny_prompt = prompt.partial(adjective="funny")

# ç°åœ¨åªéœ€è¦æä¾› topic
result = funny_prompt.format(topic="Python")</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">invoke</h3>
                    <p class="api-description">ä½œä¸º Runnable è°ƒç”¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">def invoke(
    input: Dict[str, Any],
    config: Optional[RunnableConfig] = None,
) -> Union[str, List[BaseMessage]]:
    """
    è°ƒç”¨æ¨¡æ¿

    Args:
        input: å˜é‡å­—å…¸
        config: è¿è¡Œé…ç½®

    Returns:
        æ ¼å¼åŒ–ç»“æœ
    """</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">from_template</h3>
                    <p class="api-description">ç±»æ–¹æ³•ï¼Œä»å­—ç¬¦ä¸²åˆ›å»ºæ¨¡æ¿ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">@classmethod
def from_template(
    cls,
    template: str,
    *,
    template_format: str = "f-string",
    partial_variables: Optional[Dict[str, Any]] = None,
    **kwargs: Any,
) -> "PromptTemplate":
    """
    ä»æ¨¡æ¿å­—ç¬¦ä¸²åˆ›å»º

    Args:
        template: æ¨¡æ¿å­—ç¬¦ä¸²
        template_format: æ¨¡æ¿æ ¼å¼
        partial_variables: éƒ¨åˆ†å˜é‡
        **kwargs: é¢å¤–å‚æ•°

    Returns:
        PromptTemplate å®ä¾‹
    """</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">from_messages</h3>
                    <p class="api-description">ChatPromptTemplate ç±»æ–¹æ³•ï¼Œä»æ¶ˆæ¯åˆ›å»ºã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">@classmethod
def from_messages(
    cls,
    messages: Sequence[
        Union[
            Tuple[str, str],  # (role, template)
            BaseMessage,       # ç›´æ¥æ¶ˆæ¯
            MessagePromptTemplate,
        ]
    ],
) -> "ChatPromptTemplate":
    """
    ä»æ¶ˆæ¯åˆ›å»ºæ¨¡æ¿

    Args:
        messages: æ¶ˆæ¯æ¨¡æ¿åˆ—è¡¨

    Returns:
        ChatPromptTemplate å®ä¾‹
    """</code></pre>
                    </div>
                </div>

                <h2 id="examples">ä½¿ç”¨ç¤ºä¾‹</h2>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import (
    PromptTemplate,
    ChatPromptTemplate,
    MessagesPlaceholder
)
from langchain_openai import ChatOpenAI

# ========== PromptTemplate ç¤ºä¾‹ ==========

# åŸºç¡€ä½¿ç”¨
prompt = PromptTemplate.from_template(
    "Tell me a {adjective} story about {topic}"
)
formatted = prompt.format(adjective="funny", topic="Python")

# éƒ¨åˆ†å¡«å……
base_prompt = PromptTemplate.from_template(
    "Write a {style} email about {topic} to {recipient}"
)
professional_prompt = base_prompt.partial(style="professional")

# ========== ChatPromptTemplate ç¤ºä¾‹ ==========

# ç®€å•èŠå¤©æ¨¡æ¿
chat_prompt = ChatPromptTemplate.from_messages([
    ("system", "You are a helpful assistant specialized in {domain}"),
    ("user", "{input}")
])

# å¸¦å†å²è®°å½•çš„èŠå¤©
chat_with_history = ChatPromptTemplate.from_messages([
    ("system", "You are a helpful assistant"),
    MessagesPlaceholder(variable_name="history"),
    ("user", "{input}")
])

# ========== ä¸ LLM é›†æˆ ==========

llm = ChatOpenAI(model="gpt-4o")

# æ–¹å¼1: æ‰‹åŠ¨æ ¼å¼åŒ–
prompt = PromptTemplate.from_template("What is {topic}?")
formatted = prompt.format(topic="LangChain")
response = llm.invoke(formatted)

# æ–¹å¼2: ä½¿ç”¨ç®¡é“ï¼ˆæ¨èï¼‰
chain = prompt | llm
response = chain.invoke({"topic": "LangChain"})

# èŠå¤©é“¾
chat_chain = chat_prompt | llm
response = chat_chain.invoke({
    "domain": "Python programming",
    "input": "What is a decorator?"
})

# ========== åŠ¨æ€ç¤ºä¾‹é€‰æ‹© ==========

from langchain_core.prompts import FewShotPromptTemplate

examples = [
    {"input": "happy", "output": " joyful"},
    {"input": "sad", "output": " sorrowful"},
]

example_prompt = PromptTemplate(
    input_variables=["input", "output"],
    template="Input: {input}\nOutput: {output}"
)

few_shot_prompt = FewShotPromptTemplate(
    examples=examples,
    example_prompt=example_prompt,
    prefix="Give the synonym for the following words:",
    suffix="\nInput: {input}\nOutput:",
    input_variables=["input"]
)

chain = few_shot_prompt | llm
response = chain.invoke({"input": "excited"})</code></pre>
                </div>

                <h2>ç›¸å…³ API</h2>
                <ul>
                    <li><a href="chat-models.html">Chat Models API</a></li>
                    <li><a href="runnables.html">Runnables API</a></li>
                    <li><a href="../03-prompts.html">æ•™ç¨‹ï¼šæç¤ºå·¥ç¨‹</a></li>
                </ul>

                <div class="chapter-nav">
                    <a href="chat-models.html">â† Chat Models API</a>
                    <a href="chains.html" class="next">Chains API â†’</a>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="../assets/js/main.js"></script>
</body>
</html>
