<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘é‡å­˜å‚¨ API - LangChain 1.0</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="chapter-api-vector-stores">
    <button class="theme-toggle">ğŸŒ“</button>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>

    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1><a href="../index.html" style="color: white; text-decoration: none;">LangChain 1.0</a></h1>
                <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 5px;">API å‚è€ƒ</p>
            </div>
            <div class="sidebar-nav"></div>
        </nav>

        <main class="main-content">
            <div class="content">
                <h1>å‘é‡å­˜å‚¨ API</h1>
                <p class="subtitle">VectorStore ä¸å‘é‡æ•°æ®åº“</p>

                <div class="api-nav">
                    <a href="#overview" class="api-nav-link">æ¦‚è¿°</a>
                    <a href="#base" class="api-nav-link">åŸºç±»</a>
                    <a href="#implementations" class="api-nav-link">å®ç°ç±»</a>
                    <a href="#examples" class="api-nav-link">ç¤ºä¾‹</a>
                </div>

                <h2 id="overview">æ¦‚è¿°</h2>
                <p>å‘é‡å­˜å‚¨ç”¨äºå­˜å‚¨å’Œæ£€ç´¢é«˜ç»´å‘é‡ï¼Œæ”¯æŒè¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢ï¼Œæ˜¯ RAG åº”ç”¨çš„æ ¸å¿ƒç»„ä»¶ã€‚</p>

                <pre class="mermaid">graph TD
                    A[VectorStore] --> B[Chroma]
                    A --> C[FAISS]
                    A --> D[Pinecone]
                    A --> E[Weaviate]
                    A --> F[Milvus]
                    A --> G[PineconeVectorStore]
                    A --> H[ElasticVectorSearch]

                    A --> I[æœ¬åœ°å­˜å‚¨]
                    I --> J[Chroma]
                    I --> K[FAISS]

                    A --> L[äº‘ç«¯å­˜å‚¨]
                    L --> M[Pinecone]
                    L --> N[Weaviate]

                    style A fill:#e1f5fe
                    style I fill:#c8e6c9</code></pre>

                <h2 id="base">åŸºç±»</h2>

                <div class="api-section">
                    <h3 class="api-title">VectorStore</h3>
                    <p class="api-description">å‘é‡å­˜å‚¨æŠ½è±¡åŸºç±»ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_core.vectorstores import VectorStore

class VectorStore(ABC):
    """å‘é‡å­˜å‚¨åŸºç±»"""

    @property
    @abstractmethod
    def embeddings(self) -> Embeddings:
        """å…³è”çš„åµŒå…¥æ¨¡å‹"""

    @abstractmethod
    def add_texts(
        self,
        texts: List[str],
        metadatas: Optional[List[dict]] = None,
        **kwargs: Any,
    ) -> List[str]:
        """
        æ·»åŠ æ–‡æœ¬

        Args:
            texts: æ–‡æœ¬åˆ—è¡¨
            metadatas: å…ƒæ•°æ®åˆ—è¡¨
            **kwargs: é¢å¤–å‚æ•°

        Returns:
            æ·»åŠ çš„æ–‡æ¡£ ID åˆ—è¡¨
        """

    @abstractmethod
    def similarity_search(
        self,
        query: str,
        k: int = 4,
        **kwargs: Any,
    ) -> List[Document]:
        """
        ç›¸ä¼¼åº¦æœç´¢

        Args:
            query: æŸ¥è¯¢æ–‡æœ¬
            k: è¿”å›ç»“æœæ•°é‡
            **kwargs: é¢å¤–å‚æ•°

        Returns:
            æœ€ç›¸ä¼¼çš„ Document åˆ—è¡¨
        """

    @abstractmethod
    def similarity_search_with_score(
        self,
        query: str,
        k: int = 4,
        **kwargs: Any,
    ) -> List[Tuple[Document, float]]:
        """
        å¸¦åˆ†æ•°çš„ç›¸ä¼¼åº¦æœç´¢

        Returns:
            (Document, ç›¸ä¼¼åº¦åˆ†æ•°) åˆ—è¡¨
        """

    def similarity_search_by_vector(
        self,
        embedding: List[float],
        k: int = 4,
        **kwargs: Any,
    ) -> List[Document]:
        """
        æŒ‰å‘é‡æœç´¢

        Args:
            embedding: æŸ¥è¯¢å‘é‡
            k: è¿”å›ç»“æœæ•°é‡

        Returns:
            æœ€ç›¸ä¼¼çš„ Document åˆ—è¡¨
        """

    def max_marginal_relevance_search(
        self,
        query: str,
        k: int = 4,
        fetch_k: int = 20,
        lambda_mult: float = 0.5,
        **kwargs: Any,
    ) -> List[Document]:
        """
        æœ€å¤§è¾¹é™…ç›¸å…³æ€§æœç´¢ (MMR)

        Args:
            query: æŸ¥è¯¢æ–‡æœ¬
            k: è¿”å›ç»“æœæ•°é‡
            fetch_k: è·å–å€™é€‰æ•°é‡
            lambda_mult: ç›¸å…³æ€§å¤šæ ·æ€§å¹³è¡¡
                (0=å¤šæ ·æ€§ä¼˜å…ˆ, 1=ç›¸å…³æ€§ä¼˜å…ˆ)

        Returns:
            Document åˆ—è¡¨
        """

    async def asimilarity_search(
        self,
        query: str,
        k: int = 4,
        **kwargs: Any,
    ) -> List[Document]:
        """å¼‚æ­¥ç›¸ä¼¼åº¦æœç´¢"""

    async def aadd_texts(
        self,
        texts: List[str],
        metadatas: Optional[List[dict]] = None,
        **kwargs: Any,
    ) -> List[str]:
        """å¼‚æ­¥æ·»åŠ æ–‡æœ¬"""

    @classmethod
    @abstractmethod
    def from_texts(
        cls,
        texts: List[str],
        embedding: Embeddings,
        metadatas: Optional[List[dict]] = None,
        **kwargs: Any,
    ) -> "VectorStore":
        """
        ä»æ–‡æœ¬åˆ›å»ºå‘é‡å­˜å‚¨

        Args:
            texts: æ–‡æœ¬åˆ—è¡¨
            embedding: åµŒå…¥æ¨¡å‹
            metadatas: å…ƒæ•°æ®åˆ—è¡¨
            **kwargs: é¢å¤–å‚æ•°

        Returns:
            VectorStore å®ä¾‹
        """

    @classmethod
    def from_documents(
        cls,
        documents: List[Document],
        embedding: Embeddings,
        **kwargs: Any,
    ) -> "VectorStore":
        """
        ä»æ–‡æ¡£åˆ›å»ºå‘é‡å­˜å‚¨

        Args:
            documents: Document åˆ—è¡¨
            embedding: åµŒå…¥æ¨¡å‹
            **kwargs: é¢å¤–å‚æ•°

        Returns:
            VectorStore å®ä¾‹
        """

    def delete(
        self,
        ids: Optional[List[str]] = None,
        **kwargs: Any,
    ) -> Optional[bool]:
        """
        åˆ é™¤æ–‡æ¡£

        Args:
            ids: è¦åˆ é™¤çš„æ–‡æ¡£ ID åˆ—è¡¨
            **kwargs: é¢å¤–å‚æ•°

        Returns:
            æ˜¯å¦æˆåŠŸ
        """

    def as_retriever(
        self,
        **kwargs: Any,
    ) -> VectorStoreRetriever:
        """
        è½¬æ¢ä¸ºæ£€ç´¢å™¨

        Args:
            **kwargs: æ£€ç´¢å™¨å‚æ•°
                - search_type: "similarity" æˆ– "mmr"
                - search_kwargs: æœç´¢å‚æ•° (k, score_threshold ç­‰)

        Returns:
            VectorStoreRetriever å®ä¾‹
        """</code></pre>
                    </div>
                </div>

                <h2 id="implementations">å®ç°ç±»</h2>

                <div class="api-section">
                    <h3 class="api-title">Chroma</h3>
                    <p class="api-description">Chroma å‘é‡æ•°æ®åº“ï¼ˆæœ¬åœ°ï¼‰ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_chroma import Chroma

class Chroma(VectorStore):
    """Chroma å‘é‡å­˜å‚¨"""

    def __init__(
        self,
        collection_name: str = "langchain",
        embedding_function: Optional[Embeddings] = None,
        persist_directory: Optional[str] = None,
        client_settings: Optional[ChromaClientSettings] = None,
        collection_metadata: Optional[dict] = None,
        client: Optional[ChromaClient] = None,
    ):
        """
        åˆå§‹åŒ– Chroma

        Args:
            collection_name: é›†åˆåç§°
            embedding_function: åµŒå…¥æ¨¡å‹
            persist_directory: æŒä¹…åŒ–ç›®å½•
            client_settings: å®¢æˆ·ç«¯è®¾ç½®
            collection_metadata: é›†åˆå…ƒæ•°æ®
            client: è‡ªå®šä¹‰å®¢æˆ·ç«¯
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_chroma import Chroma
from langchain_openai import OpenAIEmbeddings

# å†…å­˜å­˜å‚¨
vectorstore = Chroma(
    embedding_function=OpenAIEmbeddings()
)

# æŒä¹…åŒ–å­˜å‚¨
vectorstore = Chroma(
    collection_name="my_collection",
    embedding_function=OpenAIEmbeddings(),
    persist_directory="./chroma_db"
)

# ä»æ–‡æœ¬åˆ›å»º
vectorstore = Chroma.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2", "æ–‡æ¡£3"],
    embedding=OpenAIEmbeddings(),
    metadatas=[
        {"source": "txt1"},
        {"source": "txt2"},
        {"source": "txt3"}
    ],
    collection_name="my_collection"
)

# ç›¸ä¼¼åº¦æœç´¢
results = vectorstore.similarity_search("æŸ¥è¯¢", k=3)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">FAISS</h3>
                    <p class="api-description">FAISS å‘é‡ç´¢å¼•ï¼ˆæœ¬åœ°ï¼‰ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.vectorstores import FAISS

class FAISS(VectorStore):
    """FAISS å‘é‡å­˜å‚¨"""

    def __init__(
        self,
        embedding_function: Embeddings,
        index: Any,
        docstore: Docstore,
        index_to_docstore_id: Dict[int, str],
    ):
        """
        åˆå§‹åŒ– FAISS

        Args:
            embedding_function: åµŒå…¥æ¨¡å‹
            index: FAISS ç´¢å¼•
            docstore: æ–‡æ¡£å­˜å‚¨
            index_to_docstore_id: ç´¢å¼•åˆ°æ–‡æ¡£ ID çš„æ˜ å°„
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_community.vectorstores import FAISS
from langchain_openai import OpenAIEmbeddings

# ä»æ–‡æœ¬åˆ›å»º
vectorstore = FAISS.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2", "æ–‡æ¡£3"],
    embedding=OpenAIEmbeddings()
)

# æ·»åŠ æ–‡æ¡£
vectorstore.add_texts(["æ–°æ–‡æ¡£"])

# ç›¸ä¼¼åº¦æœç´¢
results = vectorstore.similarity_search("æŸ¥è¯¢", k=3)

# ä¿å­˜ç´¢å¼•
vectorstore.save_local("faiss_index")

# åŠ è½½ç´¢å¼•
vectorstore = FAISS.load_local(
    "faiss_index",
    OpenAIEmbeddings(),
    allow_dangerous_deserialization=True
)

# MMR æœç´¢
results = vectorstore.max_marginal_relevance_search(
    "æŸ¥è¯¢",
    k=3,
    lambda_mult=0.5
)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">PineconeVectorStore</h3>
                    <p class="api-description">Pinecone äº‘ç«¯å‘é‡æ•°æ®åº“ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_pinecone import PineconeVectorStore

class PineconeVectorStore(VectorStore):
    """Pinecone å‘é‡å­˜å‚¨"""

    @classmethod
    def from_texts(
        cls,
        texts: List[str],
        embedding: Embeddings,
        index_name: str,
        namespace: str = "",
        metadatas: Optional[List[dict]] = None,
        **kwargs: Any,
    ) -> "PineconeVectorStore":
        """
        ä»æ–‡æœ¬åˆ›å»º

        Args:
            texts: æ–‡æœ¬åˆ—è¡¨
            embedding: åµŒå…¥æ¨¡å‹
            index_name: Pinecone ç´¢å¼•åç§°
            namespace: å‘½åç©ºé—´
            metadatas: å…ƒæ•°æ®åˆ—è¡¨
            **kwargs: é¢å¤–å‚æ•°
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_pinecone import PineconeVectorStore
from langchain_openai import OpenAIEmbeddings

# åˆå§‹åŒ–
import os
os.environ["PINECONE_API_KEY"] = "your-api-key"

vectorstore = PineconeVectorStore.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2"],
    embedding=OpenAIEmbeddings(),
    index_name="my-index",
    namespace="my-namespace"
)

# æœç´¢
results = vectorstore.similarity_search("æŸ¥è¯¢", k=3)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">WeaviateClient</h3>
                    <p class="api-description">Weaviate å‘é‡æ•°æ®åº“ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_weaviate.vectorstores import WeaviateVectorStore

vectorstore = WeaviateVectorStore.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2"],
    embedding=OpenAIEmbeddings(),
    index_name="MyIndex",
    text_key="text"
)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">Milvus</h3>
                    <p class="api-description">Milvus å‘é‡æ•°æ®åº“ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.vectorstores import Milvus

vectorstore = Milvus.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2"],
    embedding=OpenAIEmbeddings(),
    connection_args={"host": "localhost", "port": 19530},
    collection_name="my_collection"
)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">Qdrant</h3>
                    <p class="api-description">Qdrant å‘é‡æ•°æ®åº“ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_qdrant import QdrantVectorStore

from qdrant_client import QdrantClient

# å†…å­˜æ¨¡å¼
client = QdrantClient(":memory:")
vectorstore = QdrantVectorStore.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2"],
    embedding=OpenAIEmbeddings(),
    client=client,
    collection_name="my_collection"
)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">ElasticVectorSearch</h3>
                    <p class="api-description">Elasticsearch å‘é‡æœç´¢ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.vectorstores import ElasticsearchStore

vectorstore = ElasticsearchStore.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2"],
    embedding=OpenAIEmbeddings(),
    index_name="my-index",
    es_url="http://localhost:9200"
)</code></pre>
                    </div>
                </div>

                <h2 id="examples">ä½¿ç”¨ç¤ºä¾‹</h2>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python"># ========== ç¤ºä¾‹1: åˆ›å»ºå‘é‡å­˜å‚¨ ==========
from langchain_chroma import Chroma
from langchain_openai import OpenAIEmbeddings

vectorstore = Chroma(
    collection_name="my_docs",
    embedding_function=OpenAIEmbeddings(),
    persist_directory="./chroma_db"
)

# ========== ç¤ºä¾‹2: æ·»åŠ æ–‡æ¡£ ==========
from langchain_core.documents import Document

documents = [
    Document(page_content="Python æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€", metadata={"id": 1}),
    Document(page_content="JavaScript ä¹Ÿæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€", metadata={"id": 2})
]

vectorstore.add_documents(documents)

# ========== ç¤ºä¾‹3: ç›¸ä¼¼åº¦æœç´¢ ==========
results = vectorstore.similarity_search("ç¼–ç¨‹è¯­è¨€", k=2)

for doc in results:
    print(f"å†…å®¹: {doc.page_content}")
    print(f"å…ƒæ•°æ®: {doc.metadata}")

# ========== ç¤ºä¾‹4: å¸¦åˆ†æ•°æœç´¢ ==========
results = vectorstore.similarity_search_with_score("ç¼–ç¨‹è¯­è¨€", k=2)

for doc, score in results:
    print(f"åˆ†æ•°: {score:.4f}, å†…å®¹: {doc.page_content}")

# ========== ç¤ºä¾‹5: æŒ‰å‘é‡æœç´¢ ==========
query_vector = OpenAIEmbeddings().embed_query("ç¼–ç¨‹è¯­è¨€")
results = vectorstore.similarity_search_by_vector(query_vector, k=3)

# ========== ç¤ºä¾‹6: MMR æœç´¢ ==========
results = vectorstore.max_marginal_relevance_search(
    "ç¼–ç¨‹è¯­è¨€",
    k=3,
    fetch_k=10,
    lambda_mult=0.5
)

# ========== ç¤ºä¾‹7: è¿‡æ»¤æœç´¢ ==========
from langchain_chroma import Chroma

# å…ƒæ•°æ®è¿‡æ»¤
results = vectorstore.similarity_search(
    "ç¼–ç¨‹è¯­è¨€",
    k=3,
    filter={"id": {"$eq": 1}}
)

# ========== ç¤ºä¾‹8: è½¬æ¢ä¸ºæ£€ç´¢å™¨ ==========
retriever = vectorstore.as_retriever(
    search_type="similarity",
    search_kwargs={"k": 3}
)

# ä½¿ç”¨æ£€ç´¢å™¨
results = retriever.invoke("ç¼–ç¨‹è¯­è¨€")

# ========== ç¤ºä¾‹9: MMR æ£€ç´¢å™¨ ==========
retriever = vectorstore.as_retriever(
    search_type="mmr",
    search_kwargs={
        "k": 3,
        "fetch_k": 10,
        "lambda_mult": 0.5
    }
)

# ========== ç¤ºä¾‹10: åˆ é™¤æ–‡æ¡£ ==========
ids = ["doc_id_1", "doc_id_2"]
vectorstore.delete(ids)

# ========== ç¤ºä¾‹11: FAISS ç´¢å¼• ==========
from langchain_community.vectorstores import FAISS

# åˆ›å»ºç´¢å¼•
vectorstore = FAISS.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2"],
    embedding=OpenAIEmbeddings()
)

# ä¿å­˜
vectorstore.save_local("faiss_index")

# åŠ è½½
vectorstore = FAISS.load_local(
    "faiss_index",
    OpenAIEmbeddings(),
    allow_dangerous_deserialization=True
)

# ========== ç¤ºä¾‹12: æ‰¹é‡æ·»åŠ  ==========
texts = ["æ–‡æ¡£" + str(i) for i in range(1000)]
metadatas = [{"index": i} for i in range(1000)]

vectorstore.add_texts(texts, metadatas)</code></pre>
                </div>

                <h2>ç›¸å…³ API</h2>
                <ul>
                    <li><a href="retrievers.html">Retrievers API</a></li>
                    <li><a href="embeddings.html">Embeddings API</a></li>
                    <li><a href="../12-retrieval.html">æ•™ç¨‹ï¼šRAG æ£€ç´¢</a></li>
                </ul>

                <div class="chapter-nav">
                    <a href="embeddings.html">â† Embeddings API</a>
                    <a href="retrievers.html" class="next">Retrievers API â†’</a>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="../assets/js/main.js"></script>
</body>
</html>
