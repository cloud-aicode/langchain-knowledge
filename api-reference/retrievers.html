<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ£€ç´¢å™¨ API - LangChain 1.0</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="chapter-api-retrievers">
    <button class="theme-toggle">ğŸŒ“</button>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>

    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1><a href="../index.html" style="color: white; text-decoration: none;">LangChain 1.0</a></h1>
                <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 5px;">API å‚è€ƒ</p>
            </div>
            <div class="sidebar-nav"></div>
        </nav>

        <main class="main-content">
            <div class="content">
                <h1>æ£€ç´¢å™¨ API</h1>
                <p class="subtitle">BaseRetriever ä¸æ–‡æ¡£æ£€ç´¢</p>

                <div class="api-nav">
                    <a href="#overview" class="api-nav-link">æ¦‚è¿°</a>
                    <a href="#base" class="api-nav-link">åŸºç±»</a>
                    <a href="#types" class="api-nav-link">æ£€ç´¢å™¨ç±»å‹</a>
                    <a href="#examples" class="api-nav-link">ç¤ºä¾‹</a>
                </div>

                <h2 id="overview">æ¦‚è¿°</h2>
                <p>æ£€ç´¢å™¨æ˜¯ LangChain ä¸­è·å–ç›¸å…³æ–‡æ¡£çš„æ ‡å‡†æ¥å£ï¼Œé€šå¸¸åŸºäºå‘é‡å­˜å‚¨å®ç°è¯­ä¹‰æœç´¢ã€‚</p>

                <pre class="mermaid">graph TD
                    A[BaseRetriever] --> B[VectorStoreRetriever]
                    A --> C[BM25Retriever]
                    A --> D[MultiQueryRetriever]
                    A --> E[ContextualCompressionRetriever]
                    A --> F[EnsembleRetriever]
                    A --> G[ParentDocumentRetriever]
                    A --> H[SelfQueryRetriever]

                    B --> I[ç›¸ä¼¼åº¦æ£€ç´¢]
                    B --> J[MMR æ£€ç´¢]

                    style A fill:#e1f5fe
                    style B fill:#c8e6c9</code></pre>

                <h2 id="base">åŸºç±»</h2>

                <div class="api-section">
                    <h3 class="api-title">BaseRetriever</h3>
                    <p class="api-description">æ‰€æœ‰æ£€ç´¢å™¨çš„æŠ½è±¡åŸºç±»ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_core.retrievers import BaseRetriever

class BaseRetriever(Runnable[str, List[Document]], ABC):
    """æ£€ç´¢å™¨åŸºç±»"""

    # å¿…é¡»å®ç°çš„æ–¹æ³•
    @abstractmethod
    def _get_relevant_documents(
        self,
        query: str,
        *,
        run_manager: Optional[CallbackManagerForRetrieverRun] = None,
        **kwargs: Any,
    ) -> List[Document]:
        """
        è·å–ç›¸å…³æ–‡æ¡£ï¼ˆå­ç±»å®ç°ï¼‰

        Args:
            query: æŸ¥è¯¢æ–‡æœ¬
            run_manager: å›è°ƒç®¡ç†å™¨
            **kwargs: é¢å¤–å‚æ•°

        Returns:
            ç›¸å…³æ–‡æ¡£åˆ—è¡¨
        """

    async def _aget_relevant_documents(
        self,
        query: str,
        *,
        run_manager: Optional[CallbackManagerForRetrieverRun] = None,
        **kwargs: Any,
    ) -> List[Document]:
        """
        å¼‚æ­¥è·å–ç›¸å…³æ–‡æ¡£ï¼ˆå­ç±»å¯é€‰å®ç°ï¼‰

        é»˜è®¤è°ƒç”¨ _get_relevant_documents
        """
        return await asyncio.to_thread(
            self._get_relevant_documents,
            query,
            run_manager=run_manager,
            **kwargs
        )

    # å…¬å…±æ¥å£
    def get_relevant_documents(
        self,
        query: str,
        **kwargs: Any,
    ) -> List[Document]:
        """
        è·å–ç›¸å…³æ–‡æ¡£

        Args:
            query: æŸ¥è¯¢æ–‡æœ¬
            **kwargs: é¢å¤–å‚æ•°

        Returns:
            ç›¸å…³æ–‡æ¡£åˆ—è¡¨
        """

    async def aget_relevant_documents(
        self,
        query: str,
        **kwargs: Any,
    ) -> List[Document]:
        """å¼‚æ­¥è·å–ç›¸å…³æ–‡æ¡£"""

    # Runnable æ¥å£å®ç°
    def invoke(
        self,
        input: str,
        config: Optional[RunnableConfig] = None,
        **kwargs: Any,
    ) -> List[Document]:
        """
        è°ƒç”¨æ£€ç´¢å™¨ï¼ˆRunnable æ¥å£ï¼‰

        Args:
            input: æŸ¥è¯¢æ–‡æœ¬
            config: è¿è¡Œé…ç½®
            **kwargs: é¢å¤–å‚æ•°

        Returns:
            ç›¸å…³æ–‡æ¡£åˆ—è¡¨
        """

    async def ainvoke(
        self,
        input: str,
        config: Optional[RunnableConfig] = None,
        **kwargs: Any,
    ) -> List[Document]:
        """å¼‚æ­¥è°ƒç”¨æ£€ç´¢å™¨"""

    def bind(self, **kwargs: Any) -> "BaseRetriever":
        """
        ç»‘å®šå‚æ•°

        Args:
            **kwargs: è¦ç»‘å®šçš„å‚æ•°

        Returns:
            ç»‘å®šå‚æ•°åçš„æ£€ç´¢å™¨
        """

    def with_config(
        self,
        config: RunnableConfig,
    ) -> "BaseRetriever":
        """
        ç»‘å®šé…ç½®

        Args:
            config: è¿è¡Œé…ç½®

        Returns:
            å¸¦é…ç½®çš„æ£€ç´¢å™¨
        """</code></pre>
                    </div>
                </div>

                <h2 id="types">æ£€ç´¢å™¨ç±»å‹</h2>

                <div class="api-section">
                    <h3 class="api-title">VectorStoreRetriever</h3>
                    <p class="api-description">å‘é‡å­˜å‚¨æ£€ç´¢å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_core.vectorstores import VectorStoreRetriever

class VectorStoreRetriever(BaseRetriever):
    """å‘é‡å­˜å‚¨æ£€ç´¢å™¨"""

    vectorstore: VectorStore
    """å…³è”çš„å‘é‡å­˜å‚¨"""

    search_type: Literal["similarity", "mmr"] = "similarity"
    """æœç´¢ç±»å‹"""

    search_kwargs: Dict[str, Any] = {}
    """æœç´¢å‚æ•°"""

    # å¸¸ç”¨æœç´¢å‚æ•°:
    # k: è¿”å›æ–‡æ¡£æ•°é‡
    # score_threshold: ç›¸ä¼¼åº¦é˜ˆå€¼
    # fetch_k: MMR å€™é€‰æ•°é‡
    # lambda_mult: MMR å¹³è¡¡å‚æ•°
    # filter: å…ƒæ•°æ®è¿‡æ»¤æ¡ä»¶

    def _get_relevant_documents(
        self,
        query: str,
        **kwargs: Any,
    ) -> List[Document]:
        """
        è·å–ç›¸å…³æ–‡æ¡£

        Args:
            query: æŸ¥è¯¢æ–‡æœ¬
            **kwargs: ä¸´æ—¶è¦†ç›– search_kwargs

        Returns:
            ç›¸å…³æ–‡æ¡£åˆ—è¡¨
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_chroma import Chroma
from langchain_openai import OpenAIEmbeddings

# åˆ›å»ºå‘é‡å­˜å‚¨
vectorstore = Chroma.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2", "æ–‡æ¡£3"],
    embedding=OpenAIEmbeddings()
)

# è½¬æ¢ä¸ºæ£€ç´¢å™¨
retriever = vectorstore.as_retriever()

# è‡ªå®šä¹‰æ£€ç´¢å™¨
retriever = vectorstore.as_retriever(
    search_type="similarity",
    search_kwargs={"k": 3}
)

# MMR æ£€ç´¢å™¨
retriever = vectorstore.as_retriever(
    search_type="mmr",
    search_kwargs={
        "k": 3,
        "fetch_k": 10,
        "lambda_mult": 0.5
    }
)

# ä½¿ç”¨æ£€ç´¢å™¨
docs = retriever.invoke("æŸ¥è¯¢æ–‡æœ¬")</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">BM25Retriever</h3>
                    <p class="api-description">BM25 å…³é”®è¯æ£€ç´¢å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.retrievers import BM25Retriever

class BM25Retriever(BaseRetriever):
    """BM25 æ£€ç´¢å™¨"""

    def __init__(
        self,
        documents: List[Document],
        k: int = 4,
        bm25_params: Optional[Dict[str, Any]] = None,
    ):
        """
        åˆå§‹åŒ– BM25 æ£€ç´¢å™¨

        Args:
            documents: æ–‡æ¡£åˆ—è¡¨
            k: è¿”å›æ–‡æ¡£æ•°é‡
            bm25_params: BM25 å‚æ•°
                - k1: è¯é¢‘é¥±å’Œå‚æ•° (é»˜è®¤ 1.5)
                - b: é•¿åº¦å½’ä¸€åŒ–å‚æ•° (é»˜è®¤ 0.75)
                - epsilon: IDF ä¸‹ç•Œ (é»˜è®¤ 0.25)
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_community.retrievers import BM25Retriever
from langchain_core.documents import Document

documents = [
    Document(page_content="Python æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€"),
    Document(page_content="JavaScript ä¹Ÿæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€")
]

retriever = BM25Retriever.from_documents(
    documents,
    k=2,
    bm25_params={"k1": 1.5, "b": 0.75}
)

docs = retriever.invoke("ç¼–ç¨‹è¯­è¨€")</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">MultiQueryRetriever</h3>
                    <p class="api-description">å¤šæŸ¥è¯¢æ£€ç´¢å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain.retrievers import MultiQueryRetriever

class MultiQueryRetriever(BaseRetriever):
    """å¤šæŸ¥è¯¢æ£€ç´¢å™¨"""

    retriever: BaseRetriever
    """åº•å±‚æ£€ç´¢å™¨"""

    llm_chain: Runnable
    """ç”ŸæˆæŸ¥è¯¢çš„ LLM é“¾"""

    parser_key: str = "lines"
    """è§£æé”®"""

    include_original: bool = True
    """æ˜¯å¦åŒ…å«åŸå§‹æŸ¥è¯¢"""

    def _get_relevant_documents(
        self,
        query: str,
        **kwargs: Any,
    ) -> List[Document]:
        """
        ä½¿ç”¨å¤šä¸ªæŸ¥è¯¢æ£€ç´¢
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain.retrievers import MultiQueryRetriever
from langchain_openai import ChatOpenAI
from langchain_chroma import Chroma

# åˆ›å»ºåŸºç¡€æ£€ç´¢å™¨
vectorstore = Chroma.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2"],
    embedding=OpenAIEmbeddings()
)
base_retriever = vectorstore.as_retriever()

# åˆ›å»ºå¤šæŸ¥è¯¢æ£€ç´¢å™¨
llm = ChatOpenAI(model="gpt-4o", temperature=0)
retriever = MultiQueryRetriever.from_llm(
    retriever=base_retriever,
    llm=llm,
    include_original=True
)

docs = retriever.invoke("æŸ¥è¯¢æ–‡æœ¬")</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">ContextualCompressionRetriever</h3>
                    <p class="api-description">ä¸Šä¸‹æ–‡å‹ç¼©æ£€ç´¢å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain.retrievers import ContextualCompressionRetriever

class ContextualCompressionRetriever(BaseRetriever):
    """ä¸Šä¸‹æ–‡å‹ç¼©æ£€ç´¢å™¨"""

    base_compressor: BaseDocumentCompressor
    """æ–‡æ¡£å‹ç¼©å™¨"""

    base_retriever: BaseRetriever
    """åŸºç¡€æ£€ç´¢å™¨"""

    def _get_relevant_documents(
        self,
        query: str,
        **kwargs: Any,
    ) -> List[Document]:
        """
        æ£€ç´¢å¹¶å‹ç¼©æ–‡æ¡£
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain.retrievers import ContextualCompressionRetriever
from langchain.retrievers.document_compressors import LLMChainExtractor
from langchain_openai import ChatOpenAI

# åŸºç¡€æ£€ç´¢å™¨
vectorstore = Chroma.from_texts(
    texts=["é•¿æ–‡æ¡£1...", "é•¿æ–‡æ¡£2..."],
    embedding=OpenAIEmbeddings()
)
base_retriever = vectorstore.as_retriever()

# å‹ç¼©å™¨
llm = ChatOpenAI(model="gpt-4o")
compressor = LLMChainExtractor.from_llm(llm)

# å‹ç¼©æ£€ç´¢å™¨
retriever = ContextualCompressionRetriever(
    base_compressor=compressor,
    base_retriever=base_retriever
)

docs = retriever.invoke("æŸ¥è¯¢æ–‡æœ¬")
# è¿”å›å‹ç¼©åçš„ç›¸å…³ç‰‡æ®µ</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">EnsembleRetriever</h3>
                    <p class="api-description">é›†æˆæ£€ç´¢å™¨ï¼ˆåˆå¹¶å¤šä¸ªæ£€ç´¢å™¨ï¼‰ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain.retrievers import EnsembleRetriever

class EnsembleRetriever(BaseRetriever):
    """é›†æˆæ£€ç´¢å™¨"""

    retrievers: List[BaseRetriever]
    """æ£€ç´¢å™¨åˆ—è¡¨"""

    weights: Optional[List[float]] = None
    """æƒé‡åˆ—è¡¨"""

    ranking_key: str = "score"
    """æ’åºé”®"""</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain.retrievers import EnsembleRetriever
from langchain_community.retrievers import BM25Retriever
from langchain_chroma import Chroma

# å‘é‡æ£€ç´¢å™¨
vectorstore = Chroma.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2"],
    embedding=OpenAIEmbeddings()
)
vector_retriever = vectorstore.as_retriever(search_kwargs={"k": 3})

# å…³é”®è¯æ£€ç´¢å™¨
bm25_retriever = BM25Retriever.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2"],
    k=3
)

# é›†æˆæ£€ç´¢å™¨
ensemble_retriever = EnsembleRetriever(
    retrievers=[vector_retriever, bm25_retriever],
    weights=[0.5, 0.5]
)

docs = ensemble_retriever.invoke("æŸ¥è¯¢æ–‡æœ¬")</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">ParentDocumentRetriever</h3>
                    <p class="api-description">çˆ¶å­æ–‡æ¡£æ£€ç´¢å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain.retrievers import ParentDocumentRetriever

class ParentDocumentRetriever(BaseRetriever):
    """çˆ¶å­æ–‡æ¡£æ£€ç´¢å™¨"""

    vectorstore: VectorStore
    """å­æ–‡æ¡£å‘é‡å­˜å‚¨"""

    docstore: BaseStore[str, Document]
    """çˆ¶æ–‡æ¡£å­˜å‚¨"""

    child_splitter: TextSplitter
    """å­æ–‡æ¡£åˆ†å‰²å™¨"""

    parent_splitter: Optional[TextSplitter] = None
    """çˆ¶æ–‡æ¡£åˆ†å‰²å™¨"""

    id_key: str = "doc_id"
    """ID é”®å"""</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain.retrievers import ParentDocumentRetriever
from langchain.storage import InMemoryStore
from langchain_text_splitters import RecursiveCharacterTextSplitter

# åˆ†å‰²å™¨
parent_splitter = RecursiveCharacterTextSplitter(chunk_size=2000)
child_splitter = RecursiveCharacterTextSplitter(chunk_size=400)

# åˆ›å»ºæ£€ç´¢å™¨
retriever = ParentDocumentRetriever(
    vectorstore=Chroma(embedding_function=OpenAIEmbeddings()),
    docstore=InMemoryStore(),
    child_splitter=child_splitter,
    parent_splitter=parent_splitter
)

# æ·»åŠ æ–‡æ¡£
retriever.add_documents([Document(page_content="é•¿æ–‡æ¡£...")])

# æ£€ç´¢ï¼ˆè¿”å›çˆ¶æ–‡æ¡£ï¼‰
docs = retriever.invoke("æŸ¥è¯¢æ–‡æœ¬")</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">SelfQueryRetriever</h3>
                    <p class="api-description">è‡ªæŸ¥è¯¢æ£€ç´¢å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain.retrievers import SelfQueryRetriever

class SelfQueryRetriever(BaseRetriever):
    """è‡ªæŸ¥è¯¢æ£€ç´¢å™¨"""

    vectorstore: VectorStore
    """å‘é‡å­˜å‚¨"""

    llm_chain: Runnable
    """æŸ¥è¯¢ç†è§£é“¾"""

    structured_query_translator: BaseStructuredQueryTranslator
    """æŸ¥è¯¢è½¬æ¢å™¨"""</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain.retrievers import SelfQueryRetriever
from langchain.chains.query_constructor.base import AttributeInfo
from langchain_openai import ChatOpenAI

# å®šä¹‰å…ƒæ•°æ®å­—æ®µ
metadata_field_info = [
    AttributeInfo(
        name="source",
        description="æ–‡æ¡£æ¥æº",
        type="string"
    ),
    AttributeInfo(
        name="year",
        description="æ–‡æ¡£å¹´ä»½",
        type="integer"
    )
]

# åˆ›å»ºæ£€ç´¢å™¨
retriever = SelfQueryRetriever.from_llm(
    llm=ChatOpenAI(model="gpt-4o"),
    vectorstore=vectorstore,
    document_contents="æ–‡æ¡£å†…å®¹æè¿°",
    metadata_field_info=metadata_field_info
)

# è‡ªç„¶è¯­è¨€æŸ¥è¯¢
docs = retriever.invoke("2023å¹´å…³äº Python çš„æ–‡æ¡£")</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">TimeWeightedVectorStoreRetriever</h3>
                    <p class="api-description">æ—¶é—´åŠ æƒæ£€ç´¢å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain.retrievers import TimeWeightedVectorStoreRetriever

retriever = TimeWeightedVectorStoreRetriever(
    vectorstore=vectorstore,
    decay_rate=0.01,  # è¡°å‡ç‡
    k=3
)</code></pre>
                    </div>
                </div>

                <h2 id="examples">ä½¿ç”¨ç¤ºä¾‹</h2>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python"># ========== ç¤ºä¾‹1: åŸºç¡€æ£€ç´¢å™¨ ==========
from langchain_chroma import Chroma
from langchain_openai import OpenAIEmbeddings

vectorstore = Chroma.from_texts(
    texts=["æ–‡æ¡£1", "æ–‡æ¡£2", "æ–‡æ¡£3"],
    embedding=OpenAIEmbeddings()
)
retriever = vectorstore.as_retriever(search_kwargs={"k": 2})

docs = retriever.invoke("æŸ¥è¯¢æ–‡æœ¬")

# ========== ç¤ºä¾‹2: è‡ªå®šä¹‰æ£€ç´¢å™¨ ==========
from langchain_core.retrievers import BaseRetriever

class CustomRetriever(BaseRetriever):
    def _get_relevant_documents(self, query: str) -> List[Document]:
        # è‡ªå®šä¹‰æ£€ç´¢é€»è¾‘
        return [Document(page_content=f"å…³äº {query} çš„ç»“æœ")]

retriever = CustomRetriever()
docs = retriever.invoke("æŸ¥è¯¢")

# ========== ç¤ºä¾‹3: ä¸é“¾é›†æˆ ==========
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI
from langchain_core.output_parsers import StrOutputParser

prompt = ChatPromptTemplate.from_template("""
åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜:
{context}

é—®é¢˜: {question}
""")

llm = ChatOpenAI(model="gpt-4o")

# RAG é“¾
rag_chain = (
    {"context": retriever, "question": lambda x: x["question"]}
    | prompt
    | llm
    | StrOutputParser()
)

result = rag_chain.invoke({"question": "ä»€ä¹ˆæ˜¯ LangChainï¼Ÿ"})

# ========== ç¤ºä¾‹4: è¿‡æ»¤æ£€ç´¢ ==========
retriever = vectorstore.as_retriever(
    search_kwargs={
        "k": 3,
        "filter": {"source": "python_docs"}
    }
)

# ========== ç¤ºä¾‹5: å¸¦åˆ†æ•°é˜ˆå€¼çš„æ£€ç´¢ ==========
retriever = vectorstore.as_retriever(
    search_kwargs={
        "score_threshold": 0.8,
        "k": 5
    }
)

# ========== ç¤ºä¾‹6: æµå¼æ£€ç´¢ ==========
async for chunk in retriever.astream("æŸ¥è¯¢"):
    print(chunk)

# ========== ç¤ºä¾‹7: æ‰¹é‡æ£€ç´¢ ==========
queries = ["æŸ¥è¯¢1", "æŸ¥è¯¢2", "æŸ¥è¯¢3"]
results = retriever.batch(queries)</code></pre>
                </div>

                <h2>ç›¸å…³ API</h2>
                <ul>
                    <li><a href="vector-stores.html">Vector Stores API</a></li>
                    <li><a href="../12-retrieval.html">æ•™ç¨‹ï¼šRAG æ£€ç´¢</a></li>
                </ul>

                <div class="chapter-nav">
                    <a href="vector-stores.html">â† Vector Stores API</a>
                    <a href="stores.html" class="next">Stores API â†’</a>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="../assets/js/main.js"></script>
</body>
</html>
