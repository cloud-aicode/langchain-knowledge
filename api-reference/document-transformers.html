<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡£è½¬æ¢å™¨ API - LangChain 1.0</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="chapter-api-document-transformers">
    <button class="theme-toggle">ğŸŒ“</button>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>

    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1><a href="../index.html" style="color: white; text-decoration: none;">LangChain 1.0</a></h1>
                <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 5px;">API å‚è€ƒ</p>
            </div>
            <div class="sidebar-nav"></div>
        </nav>

        <main class="main-content">
            <div class="content">
                <h1>æ–‡æ¡£è½¬æ¢å™¨ API</h1>
                <p class="subtitle">DocumentTransformer ä¸æ–‡æ¡£å¤„ç†</p>

                <div class="api-nav">
                    <a href="#overview" class="api-nav-link">æ¦‚è¿°</a>
                    <a href="#base" class="api-nav-link">åŸºç±»</a>
                    <a href="#transformers" class="api-nav-link">è½¬æ¢å™¨ç±»å‹</a>
                    <a href="#examples" class="api-nav-link">ç¤ºä¾‹</a>
                </div>

                <h2 id="overview">æ¦‚è¿°</h2>
                <p>æ–‡æ¡£è½¬æ¢å™¨å¯¹åŠ è½½çš„æ–‡æ¡£è¿›è¡Œè½¬æ¢ï¼Œå¦‚å»é‡ã€å‹ç¼©ã€å…ƒæ•°æ®æå–ç­‰æ“ä½œã€‚</p>

                <pre class="mermaid">graph TD
                    A[DocumentTransformer] --> B[Html2TextTransformer]
    A --> C[BeautifulSoupTransformer]
    A --> D[DoctypeMetadataTransformer]
    A --> E[EmbeddingsRedundantFilter]

    A --> F[åµŒå…¥ç›¸å…³]
    F --> G[EmbeddingsClusteringFilter]
    F --> H[EmbeddingsMaxMarginalRelevanceExtraFilter]

    style A fill:#e1f5fe
    style E fill:#c8e6c9</code></pre>

                <h2 id="base">åŸºç±»</h2>

                <div class="api-section">
                    <h3 class="api-title">DocumentTransformer</h3>
                    <p class="api-description">æ–‡æ¡£è½¬æ¢å™¨æŠ½è±¡åŸºç±»ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_core.documents.transformers import DocumentTransformer

class DocumentTransformer(ABC):
    """æ–‡æ¡£è½¬æ¢å™¨åŸºç±»"""

    @abstractmethod
    def transform_documents(
        self,
        documents: Sequence[Document],
        **kwargs: Any,
    ) -> Sequence[Document]:
        """
        è½¬æ¢æ–‡æ¡£åˆ—è¡¨

        Args:
            documents: æ–‡æ¡£åˆ—è¡¨
            **kwargs: é¢å¤–å‚æ•°

        Returns:
            è½¬æ¢åçš„æ–‡æ¡£åˆ—è¡¨
        """

    async def atransform_documents(
        self,
        documents: Sequence[Document],
        **kwargs: Any,
    ) -> Sequence[Document]:
        """
        å¼‚æ­¥è½¬æ¢æ–‡æ¡£åˆ—è¡¨

        é»˜è®¤è°ƒç”¨ transform_documents
        """
        return await asyncio.to_thread(
            self.transform_documents, documents, **kwargs
        )</code></pre>
                    </div>
                </div>

                <h2 id="transformers">è½¬æ¢å™¨ç±»å‹</h2>

                <div class="api-section">
                    <h3 class="api-title">Html2TextTransformer</h3>
                    <p class="api-description">HTML è½¬çº¯æ–‡æœ¬ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.document_transformers import Html2TextTransformer

class Html2TextTransformer(DocumentTransformer):
    """HTML è½¬æ–‡æœ¬è½¬æ¢å™¨"""

    def __init__(
        self,
        ignore_links: bool = False,
        ignore_images: bool = False,
        body_width: int = 0,
        ignore_emphasis: bool = False,
    ):
        """
        åˆå§‹åŒ–

        Args:
            ignore_links: æ˜¯å¦å¿½ç•¥é“¾æ¥
            ignore_images: æ˜¯å¦å¿½ç•¥å›¾ç‰‡
            body_width: è¡Œå®½é™åˆ¶ï¼ˆ0=ä¸é™åˆ¶ï¼‰
            ignore_emphasis: æ˜¯å¦å¿½ç•¥å¼ºè°ƒï¼ˆç²—ä½“/æ–œä½“ï¼‰
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_community.document_transformers import Html2TextTransformer
from langchain_core.documents import Document

transformer = Html2TextTransformer()

html_content = """
<html>
    <body>
        <h1>æ ‡é¢˜</h1>
        <p>è¿™æ˜¯æ®µè½å†…å®¹</p>
    </body>
</html>
"""

documents = [Document(page_content=html_content)]
transformed = transformer.transform_documents(documents)

print(transformed[0].page_content)
# "æ ‡é¢˜\n\nè¿™æ˜¯æ®µè½å†…å®¹"</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">BeautifulSoupTransformer</h3>
                    <p class="api-description">BeautifulSoup HTML è½¬æ¢å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.document_transformers import BeautifulSoupTransformer

class BeautifulSoupTransformer(DocumentTransformer):
    """BeautifulSoup è½¬æ¢å™¨"""

    def __init__(
        self,
        tags_to_extract: List[str] = ["p"],
        strip_tags: Optional[List[str]] = None,
        remove_lines: bool = False,
    ):
        """
        åˆå§‹åŒ–

        Args:
            tags_to_extract: è¦æå–çš„æ ‡ç­¾
            strip_tags: è¦ç§»é™¤çš„æ ‡ç­¾
            remove_lines: æ˜¯å¦ç§»é™¤ç©ºè¡Œ
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_community.document_transformers import BeautifulSoupTransformer

# æå–ç‰¹å®šæ ‡ç­¾
transformer = BeautifulSoupTransformer(
    tags_to_extract=["h1", "h2", "p"]
)

html = """
<h1>ä¸»æ ‡é¢˜</h1>
<p>æ®µè½1</p>
<p>æ®µè½2</p>
"""

docs = [Document(page_content=html)]
transformed = transformer.transform_documents(docs)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">DoctypeMetadataTransformer</h3>
                    <p class="api-description">æ·»åŠ æ–‡æ¡£ç±»å‹å…ƒæ•°æ®ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.document_transformers import DoctypeMetadataTransformer

class DoctypeMetadataTransformer(DocumentTransformer):
    """æ–‡æ¡£ç±»å‹å…ƒæ•°æ®è½¬æ¢å™¨"""

    def __init__(
        self,
        doctype: str = "",
    ):
        """
        åˆå§‹åŒ–

        Args:
            doctype: æ–‡æ¡£ç±»å‹æ ‡è¯†
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_community.document_transformers import DoctypeMetadataTransformer

transformer = DoctypeMetadataTransformer(doctype="pdf")

docs = [Document(page_content="å†…å®¹")]
transformed = transformer.transform_documents(docs)

print(transformed[0].metadata)
# {"doctype": "pdf"}</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">EmbeddingsRedundantFilter</h3>
                    <p class="api-description">åŸºäºåµŒå…¥çš„å»é‡è¿‡æ»¤å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.document_transformers import EmbeddingsRedundantFilter

class EmbeddingsRedundantFilter(DocumentTransformer):
    """åµŒå…¥å»é‡è¿‡æ»¤å™¨"""

    def __init__(
        self,
        embeddings: Embeddings,
        similarity_threshold: float = 0.95,
    ):
        """
        åˆå§‹åŒ–

        Args:
            embeddings: åµŒå…¥æ¨¡å‹
            similarity_threshold: ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆé«˜äºæ­¤å€¼è§†ä¸ºé‡å¤ï¼‰
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_community.document_transformers import EmbeddingsRedundantFilter
from langchain_openai import OpenAIEmbeddings

embeddings = OpenAIEmbeddings()

transformer = EmbeddingsRedundantFilter(
    embeddings=embeddings,
    similarity_threshold=0.9  # 90% ç›¸ä¼¼åº¦è§†ä¸ºé‡å¤
)

docs = [
    Document(page_content="Python æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€"),
    Document(page_content="Python æ˜¯ç¼–ç¨‹è¯­è¨€"),  # é‡å¤
    Document(page_content="Java ä¹Ÿæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€")
]

unique_docs = transformer.transform_documents(docs)
print(f"åŸå§‹: {len(docs)}, å»é‡å: {len(unique_docs)}")
# 3 -> 2</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">EmbeddingsClusteringFilter</h3>
                    <p class="api-description">åŸºäºåµŒå…¥èšç±»çš„é€‰æ‹©å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.document_transformers import EmbeddingsClusteringFilter

class EmbeddingsClusteringFilter(DocumentTransformer):
    """åµŒå…¥èšç±»è¿‡æ»¤å™¨"""

    def __init__(
        self,
        embeddings: Embeddings,
        num_clusters: int = 5,
        num_closest: int = 1,
    ):
        """
        åˆå§‹åŒ–

        Args:
            embeddings: åµŒå…¥æ¨¡å‹
            num_clusters: èšç±»æ•°é‡
            num_closest: æ¯ä¸ªèšç±»é€‰æ‹©çš„æœ€æ¥è¿‘æ•°é‡
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_community.document_transformers import EmbeddingsClusteringFilter
from langchain_openai import OpenAIEmbeddings

embeddings = OpenAIEmbeddings()

transformer = EmbeddingsClusteringFilter(
    embeddings=embeddings,
    num_clusters=3,      # åˆ†æˆ 3 ç»„
    num_closest=2        # æ¯ç»„é€‰ 2 ä¸ª
)

# ä»å¤§é‡æ–‡æ¡£ä¸­é€‰æ‹©ä»£è¡¨æ€§æ ·æœ¬
docs = [Document(page_content=f"æ–‡æ¡£ {i}") for i in range(100)]
selected = transformer.transform_documents(docs)
print(f"é€‰æ‹©: {len(selected)}")  # 6 (3 * 2)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">LongContextReorder</h3>
                    <p class="api-description">é•¿ä¸Šä¸‹æ–‡é‡æ’åºï¼ˆä¼˜åŒ–æ£€ç´¢ç»“æœï¼‰ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.document_transformers import LongContextReorder

class LongContextReorder(DocumentTransformer):
    """é•¿ä¸Šä¸‹æ–‡é‡æ’åº

    å°†æœ€ç›¸å…³çš„æ–‡æ¡£æ”¾åœ¨å¼€å¤´å’Œç»“å°¾ï¼Œ
    ä¸å¤ªç›¸å…³çš„æ”¾åœ¨ä¸­é—´ï¼ˆåˆ©ç”¨ LLM çš„æ³¨æ„åŠ›æ¨¡å¼ï¼‰
    """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_community.document_transformers import LongContextReorder

reorder = LongContextReorder()

docs = [
    Document(page_content="ç›¸å…³æ–‡æ¡£ 1", metadata={"score": 0.95}),
    Document(page_content="ç›¸å…³æ–‡æ¡£ 2", metadata={"score": 0.90}),
    Document(page_content="ä¸å¤ªç›¸å…³", metadata={"score": 0.50}),
    Document(page_content="æœ€ç›¸å…³", metadata={"score": 0.99})
]

# é‡æ’åºåï¼šæœ€ç›¸å…³åœ¨å‰ï¼Œæ¬¡ç›¸å…³åœ¨å
reordered = reorder.transform_documents(docs)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">NMFITextSplitter</h3>
                    <p class="api-description">éè´ŸçŸ©é˜µåˆ†è§£æ–‡æœ¬åˆ†å‰²å™¨ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_experimental.text_splitter import NMFITextSplitter

class NMFITextSplitter(DocumentTransformer):
    """NMI æ–‡æœ¬åˆ†å‰²å™¨ï¼ˆç”¨äºæ–‡æ¡£åˆ†å—ï¼‰"""</code></pre>
                    </div>
                </div>

                <h2 id="examples">ä½¿ç”¨ç¤ºä¾‹</h2>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python"># ========== ç¤ºä¾‹1: é“¾å¼è½¬æ¢ ==========
from langchain_community.document_transformers import (
    Html2TextTransformer,
    DoctypeMetadataTransformer
)

# è½¬æ¢ç®¡é“
transformers = [
    Html2TextTransformer(),
    DoctypeMetadataTransformer(doctype="html")
]

docs = [Document(page_content="<html>...</html>")]

for transformer in transformers:
    docs = transformer.transform_documents(docs)

# ========== ç¤ºä¾‹2: ä¸åŠ è½½å™¨é›†æˆ ==========
from langchain_community.document_loaders import WebBaseLoader
from langchain_community.document_transformers import Html2TextTransformer

# åŠ è½½å¹¶è½¬æ¢
loader = WebBaseLoader("https://example.com")
docs = loader.load()

transformer = Html2TextTransformer()
clean_docs = transformer.transform_documents(docs)

# ========== ç¤ºä¾‹3: å»é‡ç®¡é“ ==========
from langchain_community.document_transformers import (
    Html2TextTransformer,
    EmbeddingsRedundantFilter
)
from langchain_openai import OpenAIEmbeddings

embeddings = OpenAIEmbeddings()

pipeline = [
    Html2TextTransformer(),
    EmbeddingsRedundantFilter(embeddings, similarity_threshold=0.9)
]

# ========== ç¤ºä¾‹4: è‡ªå®šä¹‰è½¬æ¢å™¨ ==========
from langchain_core.documents.transformers import DocumentTransformer

class UppercaseTransformer(DocumentTransformer):
    def transform_documents(self, documents):
        for doc in documents:
            doc.page_content = doc.page_content.upper()
        return documents

transformer = UppercaseTransformer()
docs = transformer.transform_documents([
    Document(page_content="hello world")
])
# "HELLO WORLD"</code></pre>
                </div>

                <h2>ç›¸å…³ API</h2>
                <ul>
                    <li><a href="document-loaders.html">Document Loaders API</a></li>
                    <li><a href="text-splitters.html">Text Splitters API</a></li>
                </ul>

                <div class="chapter-nav">
                    <a href="output-parsers.html">â† Output Parsers API</a>
                    <a href="callbacks.html" class="next">Callbacks API â†’</a>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="../assets/js/main.js"></script>
</body>
</html>
