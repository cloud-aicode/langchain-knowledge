<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åµŒå…¥æ¨¡å‹ API - LangChain 1.0</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="chapter-api-embeddings">
    <button class="theme-toggle">ğŸŒ“</button>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>

    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1><a href="../index.html" style="color: white; text-decoration: none;">LangChain 1.0</a></h1>
                <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 5px;">API å‚è€ƒ</p>
            </div>
            <div class="sidebar-nav"></div>
        </nav>

        <main class="main-content">
            <div class="content">
                <h1>åµŒå…¥æ¨¡å‹ API</h1>
                <p class="subtitle">Embeddings ä¸å‘é‡ç”Ÿæˆ</p>

                <div class="api-nav">
                    <a href="#overview" class="api-nav-link">æ¦‚è¿°</a>
                    <a href="#base" class="api-nav-link">åŸºç±»</a>
                    <a href="#implementations" class="api-nav-link">å®ç°ç±»</a>
                    <a href="#examples" class="api-nav-link">ç¤ºä¾‹</a>
                </div>

                <h2 id="overview">æ¦‚è¿°</h2>
                <p>åµŒå…¥æ¨¡å‹å°†æ–‡æœ¬è½¬æ¢ä¸ºé«˜ç»´å‘é‡è¡¨ç¤ºï¼Œç”¨äºè¯­ä¹‰æœç´¢ã€ç›¸ä¼¼åº¦è®¡ç®—å’Œ RAG åº”ç”¨ã€‚</p>

                <pre class="mermaid">graph TD
                    A[Embeddings] --> B[OpenAIEmbeddings]
                    A --> C[HuggingFaceEmbeddings]
                    A --> D[CohereEmbeddings]
                    A --> E[BedrockEmbeddings]

                    A --> F[æœ¬åœ°æ¨¡å‹]
                    F --> G[SpacyEmbeddings]
                    F --> H[JinaEmbeddings]

                    style A fill:#e1f5fe
                    style B fill:#c8e6c9</code></pre>

                <h2 id="base">åŸºç±»</h2>

                <div class="api-section">
                    <h3 class="api-title">Embeddings</h3>
                    <p class="api-description">æ‰€æœ‰åµŒå…¥æ¨¡å‹çš„æŠ½è±¡åŸºç±»ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_core.embeddings import Embeddings

class Embeddings(ABC):
    """åµŒå…¥æ¨¡å‹åŸºç±»"""

    @abstractmethod
    def embed_documents(
        self,
        texts: List[str],
    ) -> List[List[float]]:
        """
        åµŒå…¥æ–‡æ¡£åˆ—è¡¨

        Args:
            texts: æ–‡æœ¬åˆ—è¡¨

        Returns:
            åµŒå…¥å‘é‡åˆ—è¡¨ï¼ˆæ¯ä¸ªå‘é‡æ˜¯æµ®ç‚¹æ•°åˆ—è¡¨ï¼‰
        """

    @abstractmethod
    def embed_query(self, text: str) -> List[float]:
        """
        åµŒå…¥æŸ¥è¯¢æ–‡æœ¬

        Args:
            text: æŸ¥è¯¢æ–‡æœ¬

        Returns:
            åµŒå…¥å‘é‡
        """

    async def aembed_documents(
        self,
        texts: List[str],
    ) -> List[List[float]]:
        """å¼‚æ­¥åµŒå…¥æ–‡æ¡£åˆ—è¡¨"""
        return await asyncio.to_thread(self.embed_documents, texts)

    async def aembed_query(self, text: str) -> List[float]:
        """å¼‚æ­¥åµŒå…¥æŸ¥è¯¢æ–‡æœ¬"""
        return await asyncio.to_thread(self.embed_query, text)

    def embed_documents_asynchronously(
        self,
        texts: List[str],
        batch_size: int = 100,
    ) -> List[List[float]]:
        """
        æ‰¹é‡å¼‚æ­¥åµŒå…¥æ–‡æ¡£

        Args:
            texts: æ–‡æœ¬åˆ—è¡¨
            batch_size: æ‰¹å¤„ç†å¤§å°

        Returns:
            åµŒå…¥å‘é‡åˆ—è¡¨
        """</code></pre>
                    </div>
                </div>

                <h2 id="implementations">å®ç°ç±»</h2>

                <div class="api-section" id="openaiembeddings">
                    <h3 class="api-title">OpenAIEmbeddings</h3>
                    <p class="api-description">OpenAI åµŒå…¥æ¨¡å‹ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_openai import OpenAIEmbeddings

class OpenAIEmbeddings(BaseModel, Embeddings):
    """OpenAI åµŒå…¥æ¨¡å‹"""

    def __init__(
        self,
        model: str = "text-embedding-3-small",
        embedding_ctx_length: Optional[int] = None,
        chunk_size: int = 1000,
        max_retries: int = 6,
        request_timeout: Optional[Union[float, Tuple[float, float]]] = None,
        openai_api_key: Optional[str] = None,
        openai_organization: Optional[str] = None,
        openai_proxy: Optional[str] = None,
        openai_api_base: Optional[str] = None,
        dimensions: Optional[int] = None,
    ):
        """
        åˆå§‹åŒ– OpenAI åµŒå…¥

        Args:
            model: æ¨¡å‹åç§°
                - text-embedding-3-small: 1536 ç»´
                - text-embedding-3-large: 3072 ç»´
                - text-embedding-ada-002: 1536 ç»´
            embedding_ctx_length: æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦
            chunk_size: æ‰¹å¤„ç†å¤§å°
            max_retries: æœ€å¤§é‡è¯•æ¬¡æ•°
            request_timeout: è¯·æ±‚è¶…æ—¶
            openai_api_key: API å¯†é’¥
            openai_organization: ç»„ç»‡ ID
            openai_proxy: ä»£ç†åœ°å€
            openai_api_base: API åŸºç¡€ URL
            dimensions: è¾“å‡ºç»´åº¦ï¼ˆä»… text-embedding-3 æ”¯æŒï¼‰
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_openai import OpenAIEmbeddings

# åŸºç¡€ä½¿ç”¨
embeddings = OpenAIEmbeddings()

# ä½¿ç”¨ç‰¹å®šæ¨¡å‹
embeddings = OpenAIEmbeddings(model="text-embedding-3-large")

# è®¾ç½®è¾“å‡ºç»´åº¦ï¼ˆä»… text-embedding-3 æ”¯æŒï¼‰
embeddings = OpenAIEmbeddings(
    model="text-embedding-3-small",
    dimensions=512  # é™ç»´åˆ° 512
)

# åµŒå…¥æŸ¥è¯¢
query_vector = embeddings.embed_query("ä»€ä¹ˆæ˜¯ LangChainï¼Ÿ")
print(f"å‘é‡ç»´åº¦: {len(query_vector)}")

# åµŒå…¥æ–‡æ¡£åˆ—è¡¨
doc_vectors = embeddings.embed_documents([
    "LangChain æ˜¯ä¸€ä¸ªæ¡†æ¶",
    "ç”¨äºæ„å»º LLM åº”ç”¨"
])</code></pre>
                    </div>
                </div>

                <div class="api-section" id="huggingfaceembeddings">
                    <h3 class="api-title">HuggingFaceEmbeddings</h3>
                    <p class="api-description">Hugging Face åµŒå…¥æ¨¡å‹ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_huggingface import HuggingFaceEmbeddings

class HuggingFaceEmbeddings(BaseModel, Embeddings):
    """Hugging Face åµŒå…¥æ¨¡å‹"""

    def __init__(
        self,
        model_name: str = "sentence-transformers/all-mpnet-base-v2",
        cache_folder: Optional[str] = None,
        model_kwargs: Optional[Dict[str, Any]] = None,
        encode_kwargs: Optional[Dict[str, Any]] = None,
        multi_process: bool = False,
        show_progress: bool = True,
    ):
        """
        åˆå§‹åŒ– HuggingFace åµŒå…¥

        Args:
            model_name: æ¨¡å‹åç§°
                - sentence-transformers/all-mpnet-base-v2
                - sentence-transformers/all-MiniLM-L6-v2
                - sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
            cache_folder: æ¨¡å‹ç¼“å­˜ç›®å½•
            model_kwargs: ä¼ é€’ç»™æ¨¡å‹çš„å‚æ•°
                - device: "cuda" æˆ– "cpu"
            encode_kwargs: ç¼–ç å‚æ•°
                - batch_size: æ‰¹å¤„ç†å¤§å°
                - normalize_embeddings: æ˜¯å¦å½’ä¸€åŒ–
            multi_process: æ˜¯å¦ä½¿ç”¨å¤šè¿›ç¨‹
            show_progress: æ˜¯å¦æ˜¾ç¤ºè¿›åº¦
        """</code></pre>
                    </div>

                    <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">å¤åˆ¶</button>
                        </div>
                        <pre><code class="language-python">from langchain_huggingface import HuggingFaceEmbeddings

# åŸºç¡€ä½¿ç”¨ï¼ˆè‹±æ–‡æ¨¡å‹ï¼‰
embeddings = HuggingFaceEmbeddings(
    model_name="sentence-transformers/all-MiniLM-L6-v2"
)

# å¤šè¯­è¨€æ¨¡å‹
embeddings = HuggingFaceEmbeddings(
    model_name="sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"
)

# ä½¿ç”¨ GPU
embeddings = HuggingFaceEmbeddings(
    model_name="sentence-transformers/all-mpnet-base-v2",
    model_kwargs={"device": "cuda"}
)

# è‡ªå®šä¹‰ç¼–ç å‚æ•°
embeddings = HuggingFaceEmbeddings(
    model_name="sentence-transformers/all-mpnet-base-v2",
    encode_kwargs={
        "batch_size": 32,
        "normalize_embeddings": True
    }
)

# åµŒå…¥
query_vector = embeddings.embed_query("æœç´¢æŸ¥è¯¢")
doc_vectors = embeddings.embed_documents(["æ–‡æ¡£1", "æ–‡æ¡£2"])</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">CohereEmbeddings</h3>
                    <p class="api-description">Cohere åµŒå…¥æ¨¡å‹ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_cohere import CohereEmbeddings

embeddings = CohereEmbeddings(
    model="embed-english-v3.0",
    cohere_api_key="your-api-key"
)

# å¯ç”¨æ¨¡å‹:
# - embed-english-v3.0: è‹±æ–‡
# - embed-multilingual-v3.0: å¤šè¯­è¨€
# - embed-english-light-v3.0: è½»é‡è‹±æ–‡
# - embed-multilingual-light-v3.0: è½»é‡å¤šè¯­è¨€</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">BedrockEmbeddings</h3>
                    <p class="api-description">AWS Bedrock åµŒå…¥æ¨¡å‹ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_aws import BedrockEmbeddings

embeddings = BedrockEmbeddings(
    model_id="amazon.titan-embed-text-v1",
    region_name="us-east-1"
)

# å¯ç”¨æ¨¡å‹:
# - amazon.titan-embed-text-v1
# - amazon.titan-embed-image-v1
# - cohere.embed-english-v3 (é€šè¿‡ Bedrock)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">GoogleGenerativeAIEmbeddings</h3>
                    <p class="api-description">Google Gemini åµŒå…¥æ¨¡å‹ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_google_genai import GoogleGenerativeAIEmbeddings

embeddings = GoogleGenerativeAIEmbeddings(
    model="models/embedding-001",
    google_api_key="your-api-key"
)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">JinaEmbeddings</h3>
                    <p class="api-description">Jina AI åµŒå…¥æ¨¡å‹ï¼ˆæœ¬åœ°/äº‘ç«¯ï¼‰ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.embeddings import JinaEmbeddings

# ä½¿ç”¨äº‘ç«¯ API
embeddings = JinaEmbeddings(
    jina_api_key="your-api-key",
    model_name="jina-embeddings-v2"  # æˆ– jina-embeddings-v2-base
)

# ä½¿ç”¨æœ¬åœ°æ¨¡å‹
embeddings = JinaEmbeddings(
    model_name="jina-embeddings-v2-base",
    # è‡ªåŠ¨ä¸‹è½½å¹¶ä½¿ç”¨æœ¬åœ°æ¨¡å‹
)</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">SpacyEmbeddings</h3>
                    <p class="api-description">spaCy åµŒå…¥æ¨¡å‹ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.embeddings import SpacyEmbeddings

embeddings = SpacyEmbeddings(
    model_name="en_core_web_md"  # éœ€è¦å…ˆä¸‹è½½: python -m spacy download en_core_web_md
)

# å¯ç”¨æ¨¡å‹:
# - en_core_web_md: ä¸­ç­‰è‹±æ–‡æ¨¡å‹
# - en_core_web_lg: å¤§å‹è‹±æ–‡æ¨¡å‹
# - zh_core_web_md: ä¸­ç­‰ä¸­æ–‡æ¨¡å‹</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">InstructorEmbeddings</h3>
                    <p class="api-description">æ”¯æŒæŒ‡ä»¤çš„åµŒå…¥æ¨¡å‹ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.embeddings import HuggingFaceInstructEmbeddings

embeddings = HuggingFaceInstructEmbeddings(
    model_name="hkunlp/instructor-large",
    model_kwargs={"device": "cuda"},
    encode_kwargs={
        "normalize_embeddings": True
    }
)

# å¸¦æŒ‡ä»¤åµŒå…¥
query_vector = embeddings.embed_query(
    "Represent the sentence for retrieving relevant documents:"
    "What is Python?"
)
doc_vector = embeddings.embed_documents(
    ["Python is a programming language"]
)[0]</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">LlamaCppEmbeddings</h3>
                    <p class="api-description">llama.cpp æœ¬åœ°åµŒå…¥ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.embeddings import LlamaCppEmbeddings

embeddings = LlamaCppEmbeddings(
    model_path="path/to/model.gguf",
    n_ctx=2048,
    n_threads=4
)

query_vector = embeddings.embed_query("æŸ¥è¯¢æ–‡æœ¬")</code></pre>
                    </div>
                </div>

                <div class="api-section">
                    <h3 class="api-title">FakeEmbeddings</h3>
                    <p class="api-description">ç”¨äºæµ‹è¯•çš„å‡åµŒå…¥æ¨¡å‹ã€‚</p>

                    <div class="api-signature">
                        <pre><code class="language-python">from langchain_community.embeddings import FakeEmbeddings

embeddings = FakeEmbeddings(size=1536)

# è¿”å›å›ºå®šå¤§å°çš„éšæœºå‘é‡
query_vector = embeddings.embed_query("ä»»æ„æ–‡æœ¬")</code></pre>
                    </div>
                </div>

                <h2 id="examples">ä½¿ç”¨ç¤ºä¾‹</h2>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python"># ========== ç¤ºä¾‹1: åŸºç¡€åµŒå…¥ ==========
from langchain_openai import OpenAIEmbeddings

embeddings = OpenAIEmbeddings()

# åµŒå…¥æŸ¥è¯¢
query_vector = embeddings.embed_query("ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ")
print(f"å‘é‡ç»´åº¦: {len(query_vector)}")

# åµŒå…¥æ–‡æ¡£
doc_vectors = embeddings.embed_documents([
    "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯",
    "æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„å­é›†"
])

# ========== ç¤ºä¾‹2: è®¡ç®—ç›¸ä¼¼åº¦ ==========
import numpy as np

def cosine_similarity(a, b):
    return np.dot(a, b) / (np.linalg.norm(a) * np.linalg.norm(b))

query = "Python ç¼–ç¨‹è¯­è¨€"
docs = ["Python æ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€", "Java ä¹Ÿå¾ˆæµè¡Œ"]

query_vec = embeddings.embed_query(query)
doc_vecs = embeddings.embed_documents(docs)

for doc, vec in zip(docs, doc_vecs):
    similarity = cosine_similarity(query_vec, vec)
    print(f"{doc}: {similarity:.4f}")

# ========== ç¤ºä¾‹3: å¼‚æ­¥åµŒå…¥ ==========
import asyncio

async def async_embedding():
    query_vec = await embeddings.aembed_query("æŸ¥è¯¢")
    doc_vecs = await embeddings.aembed_documents(["æ–‡æ¡£1", "æ–‡æ¡£2"])
    return query_vec, doc_vecs

asyncio.run(async_embedding())

# ========== ç¤ºä¾‹4: ä½¿ç”¨æœ¬åœ°æ¨¡å‹ ==========
from langchain_huggingface import HuggingFaceEmbeddings

# ä¸‹è½½å¹¶ä½¿ç”¨æœ¬åœ°æ¨¡å‹
embeddings = HuggingFaceEmbeddings(
    model_name="sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2",
    model_kwargs={"device": "cpu"},
    encode_kwargs={"normalize_embeddings": True}
)

# ========== ç¤ºä¾‹5: æ‰¹é‡åµŒå…¥å¤§é‡æ–‡æ¡£ ==========
def batch_embed(texts, batch_size=100):
    """æ‰¹é‡åµŒå…¥å¤§é‡æ–‡æ¡£"""
    all_vectors = []
    for i in range(0, len(texts), batch_size):
        batch = texts[i:i+batch_size]
        vectors = embeddings.embed_documents(batch)
        all_vectors.extend(vectors)
        print(f"å·²å¤„ç† {min(i+batch_size, len(texts))}/{len(texts)}")
    return all_vectors

texts = ["æ–‡æ¡£" + str(i) for i in range(1000)]
vectors = batch_embed(texts, batch_size=100)

# ========== ç¤ºä¾‹6: å¤šè¯­è¨€åµŒå…¥ ==========
from langchain_huggingface import HuggingFaceEmbeddings

# å¤šè¯­è¨€æ¨¡å‹
embeddings = HuggingFaceEmbeddings(
    model_name="sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"
)

# æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ç­‰
query_zh = embeddings.embed_query("ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ")
query_en = embeddings.embed_query("What is AI?")

# è®¡ç®—è·¨è¯­è¨€ç›¸ä¼¼åº¦
similarity = cosine_similarity(query_zh, query_en)
print(f"è·¨è¯­è¨€ç›¸ä¼¼åº¦: {similarity:.4f}")

# ========== ç¤ºä¾‹7: é™ç»´åµŒå…¥ ==========
from langchain_openai import OpenAIEmbeddings

# text-embedding-3 æ”¯æŒè‡ªå®šä¹‰ç»´åº¦
embeddings_small = OpenAIEmbeddings(
    model="text-embedding-3-small",
    dimensions=256  # é™åˆ° 256 ç»´
)

vector = embeddings_small.embed_query("æµ‹è¯•")
print(f"é™ç»´åå‘é‡ç»´åº¦: {len(vector)}")</code></pre>
                </div>

                <h2>æ¨¡å‹å¯¹æ¯”</h2>

                <div class="comparison-table">
                    <tr>
                        <th>æ¨¡å‹</th>
                        <th>ç»´åº¦</th>
                        <th>è¯­è¨€</th>
                        <th>éƒ¨ç½²</th>
                    </tr>
                    <tr>
                        <td>text-embedding-3-small</td>
                        <td>1536</td>
                        <td>å¤šè¯­è¨€</td>
                        <td>äº‘ç«¯</td>
                    </tr>
                    <tr>
                        <td>text-embedding-3-large</td>
                        <td>3072</td>
                        <td>å¤šè¯­è¨€</td>
                        <td>äº‘ç«¯</td>
                    </tr>
                    <tr>
                        <td>all-MiniLM-L6-v2</td>
                        <td>384</td>
                        <td>è‹±æ–‡</td>
                        <td>æœ¬åœ°</td>
                    </tr>
                    <tr>
                        <td>paraphrase-multilingual-MiniLM</td>
                        <td>384</td>
                        <td>å¤šè¯­è¨€</td>
                        <td>æœ¬åœ°</td>
                    </tr>
                    <tr>
                        <td>jina-embeddings-v2</td>
                        <td>768</td>
                        <td>å¤šè¯­è¨€</td>
                        <td>äº‘ç«¯/æœ¬åœ°</td>
                    </tr>
                </div>

                <h2>ç›¸å…³ API</h2>
                <ul>
                    <li><a href="vector-stores.html">Vector Stores API</a></li>
                    <li><a href="retrievers.html">Retrievers API</a></li>
                    <li><a href="../11-embeddings.html">æ•™ç¨‹ï¼šåµŒå…¥å‘é‡</a></li>
                </ul>

                <div class="chapter-nav">
                    <a href="text-splitters.html">â† Text Splitters API</a>
                    <a href="vector-stores.html" class="next">Vector Stores API â†’</a>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="../assets/js/main.js"></script>
</body>
</html>
