<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç¤ºå·¥ç¨‹ - LangChain 1.0 çŸ¥è¯†ç‚¹</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="chapter-prompts">
    <button class="theme-toggle">ğŸŒ“</button>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>

    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>LangChain 1.0</h1>
                <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 5px;">çŸ¥è¯†ç‚¹</p>
            </div>
            <div class="sidebar-nav"></div>
        </nav>

        <main class="main-content">
            <div class="content">
                <h1>æç¤ºå·¥ç¨‹ (Prompts)</h1>
                <p class="subtitle">æ„å»ºå’Œç®¡ç†æç¤ºä»¥æŒ‡å¯¼æ¨¡å‹è¡Œä¸º</p>

                <h2>PromptTemplate åŸºç¡€</h2>

                <h3>å­—ç¬¦ä¸²æ¨¡æ¿</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import PromptTemplate

# åŸºç¡€æ¨¡æ¿
prompt = PromptTemplate(
    input_variables=["product", "feature"],
    template="ä¸º{product}å†™ä¸€ä¸ªå¹¿å‘Šï¼Œçªå‡º{feature}è¿™ä¸ªç‰¹ç‚¹ã€‚"
)

# æ ¼å¼åŒ–æç¤º
formatted = prompt.format(
    product="æ™ºèƒ½æ‰‹è¡¨",
    feature="å¥åº·ç›‘æµ‹"
)
print(formatted)
# è¾“å‡º: ä¸ºæ™ºèƒ½æ‰‹è¡¨å†™ä¸€ä¸ªå¹¿å‘Šï¼Œçªå‡ºå¥åº·ç›‘æµ‹è¿™ä¸ªç‰¹ç‚¹ã€‚</code></pre>
                </div>

                <h3>èŠå¤©æ¨¡æ¿</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder

# ç³»ç»Ÿæç¤º + ç”¨æˆ·è¾“å…¥
prompt = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„{role}åŠ©æ‰‹ã€‚"),
    ("user", "{user_input}")
])

formatted = prompt.format_messages(
    role="Python ç¼–ç¨‹",
    user_input="å¦‚ä½•ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼ï¼Ÿ"
)
print(formatted)</code></pre>
                </div>

                <h2>é«˜çº§åŠŸèƒ½</h2>

                <h3>éƒ¨åˆ†å˜é‡</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import PromptTemplate

# é¢„è®¾éƒ¨åˆ†å˜é‡
prompt = PromptTemplate(
    template="å‘{name}ä»‹ç»{product}ï¼Œé‡ç‚¹ä»‹ç»{feature}ã€‚",
    input_variables=["name", "feature"],
    partial_variables={"product": "LangChain"}
)

# åªéœ€å¡«å…¥å‰©ä½™å˜é‡
formatted = prompt.format(
    name="å°æ˜",
    feature="æ™ºèƒ½ä½“åŠŸèƒ½"
)</code></pre>
                </div>

                <h3>æ¶ˆæ¯å ä½ç¬¦</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder

# ä½¿ç”¨ MessagesPlaceholder æ’å…¥åŠ¨æ€æ¶ˆæ¯å†å²
prompt = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„åŠ©æ‰‹ã€‚"),
    MessagesPlaceholder(variable="history"),  # å¯¹è¯å†å²
    ("user", "{user_input}")
)

formatted = prompt.format_messages(
    history=[
        {"role": "user", "content": "ä½ å¥½"},
        {"role": "assistant", "content": "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„ï¼Ÿ"}
    ],
    user_input="è®°å¾—æˆ‘ä¹‹å‰è¯´äº†ä»€ä¹ˆå—ï¼Ÿ"
)</code></pre>
                </div>

                <h2>Few-shot ç¤ºä¾‹</h2>

                <h3>é™æ€ç¤ºä¾‹</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import FewShotPromptTemplate, PromptTemplate

# å®šä¹‰ç¤ºä¾‹
examples = [
    {"input": "è‹¹æœ", "output": "çº¢è‰²æ°´æœ"},
    {"input": "é¦™è•‰", "output": "é»„è‰²æ°´æœ"},
    {"input": "æ©™å­", "output": "æ©™è‰²æ°´æœ"},
]

# ç¤ºä¾‹æ ¼å¼åŒ–æ¨¡æ¿
example_prompt = PromptTemplate(
    input_variables=["input", "output"],
    template="è¾“å…¥: {input}\nè¾“å‡º: {output}"
)

# åˆ›å»º Few-shot æç¤º
prompt = FewShotPromptTemplate(
    examples=examples,
    example_prompt=example_prompt,
    prefix="æ ¹æ®ç¤ºä¾‹å®Œæˆä»»åŠ¡",
    suffix="è¾“å…¥: {input}\nè¾“å‡º:",
    input_variables=["input"]
)

# ä½¿ç”¨
result = prompt.format(input="è¥¿ç“œ")
print(result)</code></pre>
                </div>

                <h3>åŠ¨æ€ç¤ºä¾‹é€‰æ‹©</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import FewShotPromptTemplate
from langchain_core.example_selectors import SemanticSimilarityExampleSelector
from langchain_openai import OpenAIEmbeddings
from langchain_community.vectorstores import Chroma

# åˆ›å»ºç¤ºä¾‹åº“
examples = [
    {"question": "ä»€ä¹ˆæ˜¯Python?", "answer": "Pythonæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€"},
    {"question": "ä»€ä¹ˆæ˜¯åˆ—è¡¨?", "answer": "åˆ—è¡¨æ˜¯Pythonçš„å¯å˜åºåˆ—ç±»å‹"},
    {"question": "ä»€ä¹ˆæ˜¯å­—å…¸?", "answer": "å­—å…¸æ˜¯Pythonçš„é”®å€¼å¯¹æ•°æ®ç»“æ„"},
    # ... æ›´å¤šç¤ºä¾‹
]

# ä½¿ç”¨è¯­ä¹‰ç›¸ä¼¼åº¦é€‰æ‹©ç¤ºä¾‹
selector = SemanticSimilarityExampleSelector.from_examples(
    examples=examples,
    embeddings=OpenAIEmbeddings(),
    vectorstore_cls=Chroma,
    k=2  # é€‰æ‹©æœ€ç›¸ä¼¼çš„2ä¸ªç¤ºä¾‹
)

# åŠ¨æ€ Few-shot æç¤º
prompt = FewShotPromptTemplate(
    example_selector=selector,
    example_prompt=PromptTemplate(
        input_variables=["question", "answer"],
        template="é—®é¢˜: {question}\nç­”æ¡ˆ: {answer}"
    ),
    suffix="é—®é¢˜: {question}\nç­”æ¡ˆ:",
    input_variables=["question"]
)</code></pre>
                </div>

                <h2>è¾“å‡ºè§£æå™¨</h2>

                <h3>åŸºç¡€è§£æ</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import StrOutputParser
from langchain_openai import ChatOpenAI

# åˆ›å»ºè§£æé“¾
prompt = PromptTemplate.from_template("è®²ä¸€ä¸ªå…³äº{topic}çš„ç®€çŸ­ç¬‘è¯")
output_parser = StrOutputParser()
llm = ChatOpenAI(model="gpt-4o")

# ç»„åˆï¼šprompt | llm | parser
chain = prompt | llm | output_parser

result = chain.invoke({"topic": "ç¨‹åºå‘˜"})
print(result)</code></pre>
                </div>

                <h3>ç»“æ„åŒ–è¾“å‡ºè§£æ</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import JSONOutputParser
from langchain_openai import ChatOpenAI

# å®šä¹‰æœŸæœ›çš„ JSON ç»“æ„
parser = JSONOutputParser()

# æç¤ºæ¨¡æ¿ä¸­åŒ…å«æ ¼å¼è¯´æ˜
prompt = PromptTemplate(
    template="å›ç­”ä»¥ä¸‹é—®é¢˜ï¼Œè¾“å‡ºæ ¼å¼ï¼š{format_instructions}\n\né—®é¢˜ï¼š{question}",
    input_variables=["question"],
    partial_variables={"format_instructions": parser.get_format_instructions()}
)

llm = ChatOpenAI(model="gpt-4o")
chain = prompt | llm | parser

result = chain.invoke({"question": "Python çš„ä¸»è¦ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"})
print(result)  # è¿”å›è§£æåçš„å­—å…¸</code></pre>
                </div>

                <h3>è‡ªå®šä¹‰è§£æå™¨</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.output_parsers import BaseOutputParser

class CommaSeparatedListParser(BaseOutputParser):
    """è§£æé€—å·åˆ†éš”çš„åˆ—è¡¨"""
    def parse(self, text: str):
        return [item.strip() for item in text.split(",")]

    @property
    def _type(self):
        return "comma-separated-list"

# ä½¿ç”¨
parser = CommaSeparatedListParser()
result = parser.parse("è‹¹æœ, é¦™è•‰, æ©™å­")
print(result)  # ['è‹¹æœ', 'é¦™è•‰', 'æ©™å­']</code></pre>
                </div>

                <h2>æç¤ºä¼˜åŒ–æŠ€å·§</h2>

                <div class="tip" data-label="æç¤º">
                    <strong>æ¸…æ™°æ€§åŸåˆ™</strong>ï¼šæç¤ºåº”è¯¥æ˜ç¡®æŒ‡å®šä»»åŠ¡ã€è¾“å…¥æ ¼å¼å’Œè¾“å‡ºæ ¼å¼ã€‚é¿å…æ¨¡ç³Šçš„æŒ‡ä»¤ã€‚
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python"># âŒ ä¸å¥½çš„æç¤º
bad_prompt = "å†™ä¸ªæ’åº"

# âœ“ å¥½çš„æç¤º
good_prompt = """
è¯·ç”¨ Python å†™ä¸€ä¸ªå¿«é€Ÿæ’åºå‡½æ•°ï¼Œè¦æ±‚ï¼š
1. åŒ…å«å®Œæ•´çš„å‡½æ•°å®šä¹‰
2. æ·»åŠ ç±»å‹æ³¨è§£
3. æ·»åŠ è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
4. åŒ…å«ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹
"""</code></pre>
                </div>

                <div class="warning" data-label="è­¦å‘Š">
                    <strong>é¿å…æç¤ºæ³¨å…¥</strong>ï¼šå½“æç¤ºåŒ…å«ç”¨æˆ·è¾“å…¥æ—¶ï¼Œè¦è­¦æƒ•æç¤ºæ³¨å…¥æ”»å‡»ã€‚å§‹ç»ˆéªŒè¯å’Œæ¸…ç†ç”¨æˆ·è¾“å…¥ã€‚
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python"># ä½¿ç”¨æç¤ºæ¨¡æ¿æ¥é˜²æ­¢æ³¨å…¥
from langchain_core.prompts import PromptTemplate

# å®‰å…¨ï¼šä½¿ç”¨æ¨¡æ¿è‡ªåŠ¨è½¬ä¹‰
prompt = PromptTemplate(
    template="è¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š{question}",
    input_variables=["question"]
)

# è€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆä¸å®‰å…¨ï¼‰
# unsafe = f"è¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š{user_input}"</code></pre>
                </div>

                <h2>ç®¡é“ç»„åˆ</h2>

                <p>LangChain ä½¿ç”¨ <code>|</code> æ“ä½œç¬¦å°†æç¤ºã€æ¨¡å‹å’Œè§£æå™¨è¿æ¥æˆé“¾ï¼š</p>

                <pre class="mermaid">graph LR
    A[PromptTemplate] --> B[ChatModel]
    B --> C[OutputParser]
    C --> D[ç»“æœ]</code></pre>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-language">python</span>
                        <button class="copy-btn">å¤åˆ¶</button>
                    </div>
                    <pre><code class="language-python">from langchain_core.prompts import ChatPromptTemplate
from langchain_core.output_parsers import StrOutputParser
from langchain_openai import ChatOpenAI

# åˆ›å»ºç»„ä»¶
prompt = ChatPromptTemplate.from_template("è§£é‡Š{concept}ï¼Œç”¨ä¸‰å¥è¯")
llm = ChatOpenAI(model="gpt-4o")
parser = StrOutputParser()

# ä½¿ç”¨ | ç»„åˆæˆé“¾
chain = prompt | llm | parser

# ç­‰ä»·äºï¼š
# chain = (
#     prompt
#     | llm
#     | parser
# )

# è°ƒç”¨
result = chain.invoke({"concept": "é€’å½’"})
print(result)</code></pre>
                </div>

                <h2>å¸¸è§ä½¿ç”¨æ¨¡å¼</h2>

                <table class="comparison-table">
                    <tr>
                        <th>æ¨¡å¼</th>
                        <th>ç”¨é€”</th>
                        <th>ä»£ç ç¤ºä¾‹</th>
                    </tr>
                    <tr>
                        <td>ç³»ç»Ÿæç¤º</td>
                        <td>å®šä¹‰åŠ©æ‰‹è§’è‰²</td>
                        <td><code>("system", "ä½ æ˜¯{role}")</code></td>
                    </tr>
                    <tr>
                        <td>å°‘æ ·æœ¬</td>
                        <td>æä¾›ç¤ºä¾‹</td>
                        <td><code>FewShotPromptTemplate</code></td>
                    </tr>
                    <tr>
                        <td>å¯¹è¯å†å²</td>
                        <td>å¤šè½®å¯¹è¯</td>
                        <td><code>MessagesPlaceholder("history")</code></td>
                    </tr>
                    <tr>
                        <td>ç»“æ„åŒ–è¾“å‡º</td>
                        <td>JSON è§£æ</td>
                        <td><code>JSONOutputParser()</code></td>
                    </tr>
                    <tr>
                        <td>è‡ªåŠ¨é‡è¯•</td>
                        <td>ä¿®å¤æ ¼å¼é”™è¯¯</td>
                        <td><code>RunnableRetry</code></td>
                    </tr>
                </table>

                <nav class="chapter-nav">
                    <a href="02-models.html" class="prev">â† æ¨¡å‹æ¨¡å—</a>
                    <a href="04-chains.html" class="next">é“¾å¼è°ƒç”¨ â†’</a>
                </nav>

                <div class="exercise-section">
                    <h3>âœï¸ ç»ƒä¹ é¢˜</h3>

                    <div class="question">
                        <div class="question-title">
                            <span class="question-type">é€‰æ‹©é¢˜</span>
                            1. <code>MessagesPlaceholder</code> çš„ä¸»è¦ç”¨é€”æ˜¯ï¼Ÿ
                        </div>
                        <div class="options">
                            <div class="option" onclick="this.classList.toggle('selected')">A. æ ¼å¼åŒ–ç”¨æˆ·è¾“å…¥</div>
                            <div class="option correct-option onclick="this.classList.toggle('selected')">B. æ’å…¥åŠ¨æ€å¯¹è¯å†å²</div>
                            <div class="option" onclick="this.classList.toggle('selected')">C. è§£ææ¨¡å‹è¾“å‡º</div>
                            <div class="option" onclick="this.classList.toggle('selected')">D. é€‰æ‹© Few-shot ç¤ºä¾‹</div>
                        </div>
                    </div>

                    <div class="question">
                        <div class="question-title">
                            <span class="question-type">ç¼–ç¨‹é¢˜</span>
                            2. åˆ›å»ºä¸€ä¸ªèŠå¤©æç¤ºæ¨¡æ¿ï¼ŒåŒ…å«ï¼šç³»ç»Ÿæç¤ºã€å¯¹è¯å†å²å ä½ç¬¦ã€ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å®ç°è°ƒç”¨
                        </div>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: var(--primary-color);">æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>
                            <div class="code-block" style="margin-top: 10px;">
                                <div class="code-header">
                                    <span class="code-language">python</span>
                                    <button class="copy-btn">å¤åˆ¶</button>
                                </div>
                                <pre><code class="language-python">from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain_openai import ChatOpenAI

# åˆ›å»ºèŠå¤©æ¨¡æ¿
prompt = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„{domain}é¡¾é—®ã€‚"),
    MessagesPlaceholder(variable="chat_history"),
    ("user", "{user_input}")
])

# åˆ›å»ºæ¨¡å‹
llm = ChatOpenAI(model="gpt-4o")

# ç»„åˆæˆé“¾
chain = prompt | llm

# è°ƒç”¨
response = chain.invoke({
    "domain": "Python ç¼–ç¨‹",
    "chat_history": [
        {"role": "user", "content": "ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ"},
        {"role": "assistant", "content": "è£…é¥°å™¨æ˜¯ä¿®æ”¹å‡½æ•°è¡Œä¸ºçš„å‡½æ•°..."}
    ],
    "user_input": "èƒ½ä¸¾ä¸ªå…·ä½“ä¾‹å­å—ï¼Ÿ"
})

print(response.content)</code></pre>
                            </div>
                        </details>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="assets/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</body>
</html>